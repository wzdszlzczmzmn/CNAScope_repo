(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[52],{7609:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/database/detail",function(){return n(6106)}])},9792:function(e,t,n){"use strict";var r=n(5893),a=n(9555),l=n(8514),o=n(192),i=n(9227),s=n(7294);t.Z=e=>{let{isShowLeft:t,handleIsShowLeftChange:n,title:c}=e,[d,h]=(0,s.useState)(!1),g=()=>{n(),h(!1)},x=()=>{h(!0)},f=()=>{h(!1)};return(0,r.jsx)(a.Z,{placement:"top",title:"".concat(t?"Close":"Open"," ").concat(c),open:d,children:t?(0,r.jsx)(l.ZP,{shape:"circle",icon:(0,r.jsx)(o.Z,{}),onClick:g,onMouseEnter:x,onMouseLeave:f}):(0,r.jsx)(l.ZP,{shape:"circle",icon:(0,r.jsx)(i.Z,{}),onClick:g,onMouseEnter:x,onMouseLeave:f})})}},9328:function(e,t,n){"use strict";var r=n(5893),a=n(5114);let l={"Bin Integer":"volcano","Bin Log":"magenta","Gene Integer":"blue","Gene Log":"purple"},o={backgroundColor:"#f0f0f0",color:"#555",border:"1px solid #d9d9d9"};t.Z=e=>{let{value:t}=e;if(!t)return(0,r.jsx)(a.Z,{value:"--",style:o});let n=l[t]||"default";return(0,r.jsx)(a.Z,{value:t,color:n})}},8498:function(e,t,n){"use strict";var r=n(5893),a=n(5114);let l={bulkDNA:"blue",bulkDNAles:"purple",scDNA:"green",scRNA:"orange",ST:"red"};t.Z=e=>{let{value:t}=e;if(!t)return(0,r.jsx)(a.Z,{value:"--",color:"default"});let n=l[t]||"default";return(0,r.jsx)(a.Z,{value:t,color:n})}},5168:function(e,t,n){"use strict";var r=n(5893),a=n(5114);let l={cell:"red",sample:"gold",spot:"lime"},o={backgroundColor:"#f0f0f0",color:"#555",border:"1px solid #d9d9d9"};t.Z=e=>{let{value:t}=e;if(!t)return(0,r.jsx)(a.Z,{value:"--",style:o});let n=l[t.toLowerCase()]||"default";return(0,r.jsx)(a.Z,{value:t,color:n})}},1597:function(e,t,n){"use strict";var r=n(5893),a=n(5114);let l={hg19:"blue",hg38:"green"};t.Z=e=>{let{value:t}=e;if(!t)return(0,r.jsx)(a.Z,{value:"--",color:"default"});let n=l[t]||"default";return(0,r.jsx)(a.Z,{value:t,color:n})}},3619:function(e,t,n){"use strict";var r=n(5893),a=n(5114);let l={"10x Official":"geekblue",cBioportal:"cyan",COSMIC:"magenta","GDC Portal":"volcano",HSCGD:"green",scTML:"orange"};t.Z=e=>{let{value:t}=e,n=l[t]||"default";return(0,r.jsx)(a.Z,{value:t,color:n})}},1080:function(e,t,n){"use strict";var r=n(5893),a=n(9073),l=n(3368);t.Z=e=>{let{width:t,height:n,containerSx:o,children:i}=e;return(0,r.jsx)(a.Z,{sx:{width:t,height:n,justifyContent:"center",alignItems:"center",...o},children:i||(0,r.jsx)(l.Z,{component:"span",sx:{fontSize:"24px",fontWeight:"500"},children:"A Error Occur!"})})}},9967:function(e,t,n){"use strict";var r=n(5893),a=n(9073),l=n(4581);t.Z=e=>{let{width:t,height:n,containerSx:o,children:i}=e;return(0,r.jsx)(a.Z,{sx:{width:t,height:n,justifyContent:"center",alignItems:"center",...o},children:i||(0,r.jsx)("div",{style:{width:"100%",textAlign:"center"},children:(0,r.jsx)(l.Z,{tip:"Loading",size:"large",children:(0,r.jsx)("div",{style:{paddingTop:20}})})})})}},2252:function(e,t,n){"use strict";var r=n(5893),a=n(1550);t.Z=e=>{let{value:t,color:n="default"}=e;if(!t||"string"!=typeof t)return(0,r.jsx)(a.Z,{color:"default",children:"--"});let l=t.split(/[,/]/).map(e=>e.trim()).filter(Boolean);return(0,r.jsx)(r.Fragment,{children:l.map((e,t)=>(0,r.jsx)(a.Z,{color:n,children:e},"".concat(e,"-").concat(t)))})}},4:function(e,t,n){"use strict";var r=n(5893),a=n(9555);t.Z=e=>{let{text:t,width:n=200}=e;return(0,r.jsx)(a.Z,{title:t,children:(0,r.jsx)("div",{style:{minWidth:"0px",maxWidth:n,overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},children:t||"--"})})}},3750:function(e,t,n){"use strict";var r=n(5893),a=n(996);t.Z=e=>{let{isShowLeft:t,leftPanel:n,rightPanel:l,leftPanelWidth:o=280}=e;return(0,r.jsxs)(a.Z,{onResize:e=>{},children:[(0,r.jsx)(a.Z.Panel,{style:{paddingRight:t?"12px":0},size:t?o:0,children:t?n:null}),(0,r.jsx)(a.Z.Panel,{style:{paddingLeft:"12px"},resizable:!1,children:l})]})}},5114:function(e,t,n){"use strict";var r=n(5893),a=n(1550);t.Z=e=>{let{value:t,color:n,style:l}=e;return(0,r.jsx)(a.Z,{style:{borderRadius:"20px",padding:"2px 8px",cursor:"default",...l},color:n,children:t})}},7980:function(e,t,n){"use strict";n.d(t,{k:function(){return l}});var r=n(7834),a=n(3165);let l=(0,r.Z)(a.Z)({"& .ant-table":{"& .ant-table-container":{"& .ant-table-body, & .ant-table-content":{scrollbarColor:"#eaeaea transparent"}}}})},1499:function(e,t,n){"use strict";var r=n(7066),a=n(5955);let l=r.Z.create({baseURL:a.Sg,timeout:6e4,headers:{"Content-Type":"application/json"}});t.Z=l},5955:function(e,t,n){"use strict";n.d(t,{Sg:function(){return r},Vl:function(){return a},l:function(){return l}});let r="https://cna.fengslab.com/api",a=r+"/database",l=r+"/analysis"},8244:function(e,t,n){"use strict";n.d(t,{$V:function(){return i},N0:function(){return o},OG:function(){return d},gS:function(){return s},gy:function(){return p},h8:function(){return g},ks:function(){return u},l$:function(){return c},l4:function(){return f},tj:function(){return l},u4:function(){return h},vS:function(){return x},xW:function(){return a}});var r=n(5955);let a=()=>"".concat(r.Vl,"/datasets/"),l=e=>"".concat(r.Vl,"/datasets/").concat(encodeURIComponent(e),"/"),o=e=>"".concat(r.Vl,"/samples/?dataset_name=").concat(encodeURIComponent(e)),i=(e,t)=>"".concat(r.Vl,"/CNA_matrix/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),s=(e,t)=>"".concat(r.Vl,"/CNA_meta/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),c=(e,t)=>"".concat(r.Vl,"/CNA_tree/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),d=(e,t)=>"".concat(r.Vl,"/CNA_genes/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),h=(e,t)=>"".concat(r.Vl,"/CNA_newick/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),g=()=>"".concat(r.Vl,"/CNA_gene_matrix/"),x=(e,t)=>"".concat(r.Vl,"/CNA_terms/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),f=()=>"".concat(r.Vl,"/CNA_term_matrix/"),u=(e,t)=>"".concat(r.Vl,"/focal_CNA_info/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t)),p=(e,t)=>"".concat(r.Vl,"/ploidy_distribution/?dataset_name=").concat(encodeURIComponent(e),"&workflow_type=").concat(encodeURIComponent(t))},8106:function(e,t,n){"use strict";n.d(t,{_:function(){return a}});var r=n(1499);let a=async e=>{try{return(await r.Z.get(e)).data}catch(r){var t,n;let e=Error("An error occurred while fetching the data.");throw e.info=(null===(t=r.response)||void 0===t?void 0:t.data)||{},e.status=null===(n=r.response)||void 0===n?void 0:n.status,e}}},6106:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return rK}});var r=n(5893),a=n(1163),l=n(6976),o=n(8244),i=n(8106);let s=e=>{let{data:t,error:n,isLoading:r,mutate:a}=(0,l.ZP)(e?(0,o.tj)(e):null,i._);return{dataset:t||[],isLoading:r,isError:n,mutate:a}};var c=n(9967),d=n(1080),h=n(9008),g=n.n(h),x=n(9073),f=n(3368),u=n(9555),p=n(2395),m=n(5114),j=n(1664),y=n.n(j),v=n(4),C=n(3619),w=n(8498),b=n(5168),S=n(2252),_=n(9328),Z=n(1597);let k=e=>[{key:"name",label:"Dataset Name",children:(0,r.jsx)(u.Z,{title:e.link,children:(0,r.jsx)(y(),{href:e.link,target:"_blank",rel:"noopener noreferrer",children:(0,r.jsx)(m.Z,{value:e.name,color:"purple",style:{cursor:"pointer"}})})})},{key:"fullName",label:"Dataset Full Name",children:(0,r.jsx)(v.Z,{text:e.full_name,width:300})},{key:"source",label:"Source",children:(0,r.jsx)(C.Z,{value:e.source})},{key:"programme",label:"Programme",children:e.programme||"--"},{key:"modality",label:"Modality",children:(0,r.jsx)(w.Z,{value:e.modality})},{key:"obsType",label:"Observation Type",children:(0,r.jsx)(b.Z,{value:e.obs_type})},{key:"protocol",label:"Protocol",children:(0,r.jsx)(S.Z,{value:e.protocol,color:"cyan"})},{key:"platform",label:"Platform",children:e.platform||"--"},{key:"workflow",label:"Workflow",children:(0,r.jsx)(S.Z,{value:e.workflow,color:"geekblue"})},{key:"cnType",label:"CNA Value Type",children:(0,r.jsx)(_.Z,{value:e.cn_type})},{key:"reference",label:"Reference",children:(0,r.jsx)(Z.Z,{value:e.reference})},{key:"cancerType",label:"Cancer Type",children:e.cancer_type||"--"},{key:"cancerTypeFullName",label:"Cancer Type Full Name",children:e.cancer_type_full_name||"--"},{key:"sampleNum",label:"Sample Num",children:e.sample_num||"--"},{key:"cellNum",label:"Cell Num",children:e.cell_num||"--"},{key:"spotNum",label:"Spot Num",children:e.spot_num||"--"}];var A=e=>{let{dataset:t}=e,n=k(t);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px",borderBottom:"2px solid #e0e0e0",mb:"36px",paddingBottom:"12px"},children:"Dataset Information"}),(0,r.jsx)(p.Z,{bordered:!0,items:n,column:2,labelStyle:{fontWeight:"bold"}})]})};let N=e=>{let{data:t,error:n,isLoading:r,mutate:a}=(0,l.ZP)(e?(0,o.N0)(e):null,i._);return{samples:t||[],isLoading:r,isError:n,mutate:a}};var L=n(7980);let T=[{title:"Sample ID",dataIndex:"sample_id",sorter:(e,t)=>e.sample_id.toLowerCase().localeCompare(t.sample_id.toLowerCase()),fixed:"left",align:"center",render:e=>(0,r.jsx)(m.Z,{value:e,color:"volcano"})},{title:"Disease Type",dataIndex:"disease_type",sorter:(e,t)=>e.disease_type.toLowerCase().localeCompare(t.disease_type.toLowerCase()),align:"center",render:e=>(0,r.jsx)(x.Z,{sx:{alignItems:"center"},children:(0,r.jsx)(v.Z,{text:e})})},{title:"Primary Site",dataIndex:"primary_site",sorter:(e,t)=>e.primary_site.toLowerCase().localeCompare(t.primary_site.toLowerCase()),align:"center",render:e=>(0,r.jsx)(v.Z,{text:e})},{title:"Tumor Stage",dataIndex:"tumor_stage",sorter:(e,t)=>e.tumor_stage.toLowerCase().localeCompare(t.tumor_stage.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Tumor Grade",dataIndex:"tumor_grade",sorter:(e,t)=>e.tumor_grade.toLowerCase().localeCompare(t.tumor_grade.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Ethnicity",dataIndex:"ethnicity",sorter:(e,t)=>e.ethnicity.toLowerCase().localeCompare(t.ethnicity.toLowerCase()),align:"center",render:e=>(0,r.jsx)(v.Z,{text:e})},{title:"Race",dataIndex:"race",sorter:(e,t)=>e.race.toLowerCase().localeCompare(t.race.toLowerCase()),align:"center",render:e=>(0,r.jsx)(v.Z,{text:e})},{title:"Gender",dataIndex:"gender",sorter:(e,t)=>e.gender.toLowerCase().localeCompare(t.gender.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Age",dataIndex:"age",sorter:(e,t)=>{var n,r;return(null!==(n=e.age)&&void 0!==n?n:0)-(null!==(r=t.age)&&void 0!==r?r:0)},align:"center",render:e=>e||"--"},{title:"PFS",dataIndex:"pfs",sorter:(e,t)=>{var n,r;return(null!==(n=e.pfs)&&void 0!==n?n:0)-(null!==(r=t.pfs)&&void 0!==r?r:0)},align:"center",render:e=>e||"--"},{title:"Days To Death",dataIndex:"days_to_death",sorter:(e,t)=>{var n,r;return(null!==(n=e.days_to_death)&&void 0!==n?n:0)-(null!==(r=t.days_to_death)&&void 0!==r?r:0)},align:"center",render:e=>e||"--"},{title:"PFS Status",dataIndex:"pfs_status",align:"center"},{title:"Vital Status",dataIndex:"vital_status",align:"center"}],P=e=>{let{dataset:t}=e,{samples:n,isLoading:a,isError:l}=N(t.name);return a?(0,r.jsx)(c.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):l?(0,r.jsx)(d.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px",borderBottom:"2px solid #e0e0e0",mb:"36px",paddingBottom:"12px"},children:"Samples List"}),(0,r.jsx)(L.k,{columns:T,rowKey:e=>e.sample_id,dataSource:n,scroll:{x:"max-content"}})]})},M=e=>"10x Official"===e?[{title:"Cell ID",dataIndex:"cell_id",sorter:(e,t)=>e.cell_id.toLowerCase().localeCompare(t.cell_id.toLowerCase()),fixed:"left",align:"center",render:e=>(0,r.jsx)(m.Z,{value:e,color:"volcano"})},{title:"Total Num Reads",dataIndex:"total_num_reads",sorter:(e,t)=>e.total_num_reads-t.total_num_reads,align:"center",render:e=>e||"--"},{title:"Num UnMapped Reads",dataIndex:"num_unmapped_reads",sorter:(e,t)=>e.num_unmapped_reads-t.num_unmapped_reads,align:"center",render:e=>e||"--"},{title:"Num Lowmapq Reads",dataIndex:"num_lowmapq_reads",sorter:(e,t)=>e.num_lowmapq_reads-t.num_lowmapq_reads,align:"center",render:e=>e||"--"},{title:"Num Duplicate Reads",dataIndex:"num_duplicate_reads",sorter:(e,t)=>e.num_duplicate_reads-t.num_duplicate_reads,align:"center",render:e=>e||"--"},{title:"Num Mapped Dedup Reads",dataIndex:"num_mapped_dedup_reads",sorter:(e,t)=>e.num_mapped_dedup_reads-t.num_mapped_dedup_reads,align:"center",render:e=>e||"--"},{title:"Fraction Mapped Duplicates",dataIndex:"frac_mapped_duplicates",sorter:(e,t)=>e.frac_mapped_duplicates-t.frac_mapped_duplicates,align:"center",render:e=>e||"--"},{title:"Effective Depth of Coverage",dataIndex:"effective_depth_of_coverage",sorter:(e,t)=>e.effective_depth_of_coverage-t.effective_depth_of_coverage,align:"center",render:e=>e||"--"},{title:"Effective Reads per 1Mbp",dataIndex:"effective_reads_per_1Mbp",sorter:(e,t)=>e.effective_reads_per_1Mbp-t.effective_reads_per_1Mbp,align:"center",render:e=>e||"--"},{title:"Raw MapD",dataIndex:"raw_mapd",sorter:(e,t)=>e.raw_mapd-t.raw_mapd,align:"center",render:e=>e||"--"},{title:"Normalized MapD",dataIndex:"normalized_mapd",sorter:(e,t)=>e.normalized_mapd-t.normalized_mapd,align:"center",render:e=>e||"--"},{title:"Raw DimapD",dataIndex:"raw_dimapd",sorter:(e,t)=>e.raw_dimapd-t.raw_dimapd,align:"center",render:e=>e||"--"},{title:"Normalized DimapD",dataIndex:"normalized_dimapd",sorter:(e,t)=>e.normalized_dimapd-t.normalized_dimapd,align:"center",render:e=>e||"--"},{title:"Mean Ploidy",dataIndex:"mean_ploidy",sorter:(e,t)=>e.mean_ploidy-t.mean_ploidy,align:"center",render:e=>e||"--"},{title:"Ploidy Confidence",dataIndex:"ploidy_confidence",sorter:(e,t)=>e.ploidy_confidence-t.ploidy_confidence,align:"center",render:e=>e||"--"},{title:"Is High DimapD",dataIndex:"is_high_dimapd",sorter:(e,t)=>e.is_high_dimapd-t.is_high_dimapd,align:"center",render:e=>e||"--"},{title:"Is Noisy",dataIndex:"is_noisy",sorter:(e,t)=>e.is_noisy-t.is_noisy,align:"center",render:e=>e||"--"},{title:"Estimated CNV Resolution (MB)",dataIndex:"est_cnv_resolution_mb",sorter:(e,t)=>e.est_cnv_resolution_mb-t.est_cnv_resolution_mb,align:"center",render:e=>e||"--"}]:[{title:"Cell ID",dataIndex:"cell_id",sorter:(e,t)=>e.cell_id.toLowerCase().localeCompare(t.cell_id.toLowerCase()),align:"center",render:e=>(0,r.jsx)(m.Z,{value:e,color:"volcano"})},{title:"Dataset Name",dataIndex:"dataset_name",sorter:(e,t)=>e.dataset_name.toLowerCase().localeCompare(t.dataset_name.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Cell Type",dataIndex:"cell_type",sorter:(e,t)=>e.cell_type.toLowerCase().localeCompare(t.cell_type.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Confidence",dataIndex:"confidence",sorter:(e,t)=>e.confidence-t.confidence,align:"center",render:e=>e||"--"},{title:"Donor",dataIndex:"donor",sorter:(e,t)=>e.donor.toLowerCase().localeCompare(t.donor.toLowerCase()),align:"center",render:e=>e||"--"},{title:"CNV Score",dataIndex:"cnv_score",sorter:(e,t)=>e.cnv_score-t.cnv_score,align:"center",render:e=>e||"--"},{title:"CNV Status",dataIndex:"cnv_status",sorter:(e,t)=>e.cnv_status.toLowerCase().localeCompare(t.cnv_status.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Malignancy",dataIndex:"malignancy",sorter:(e,t)=>e.malignancy.toLowerCase().localeCompare(t.malignancy.toLowerCase()),align:"center",render:e=>e||"--"},{title:"Cell Label",dataIndex:"cell_label",sorter:(e,t)=>e.cell_label.toLowerCase().localeCompare(t.cell_label.toLowerCase()),align:"center",render:e=>e||"--"}],R=e=>{let{dataset:t}=e,{samples:n,isLoading:a,isError:l}=N(t.name),o=M(t.source);return a?(0,r.jsx)(c.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):l?(0,r.jsx)(d.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px",borderBottom:"2px solid #e0e0e0",mb:"36px",paddingBottom:"12px"},children:"Cells List"}),(0,r.jsx)(L.k,{columns:o,rowKey:e=>e.cell_id,dataSource:n,scroll:{x:"max-content"}})]})},z=[{title:"Cell ID",dataIndex:"cell_id",sorter:(e,t)=>{var n,r;return null===(r=e.cell_id)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cell_id)||void 0===n?void 0:n.toLowerCase())},fixed:"left",align:"center",render:e=>(0,r.jsx)(m.Z,{value:e,color:"volcano"})},{title:"Dataset Name",dataIndex:"dataset_name",sorter:(e,t)=>{var n,r;return null===(r=e.dataset_name)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.dataset_name)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Cell Type",dataIndex:"cell_type",sorter:(e,t)=>{var n,r;return null===(r=e.cell_type)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cell_type)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Confidence",dataIndex:"confidence",sorter:(e,t)=>{var n,r;return null===(r=e.confidence)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.confidence)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Donor",dataIndex:"donor",sorter:(e,t)=>{var n,r;return null===(r=e.donor)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.donor)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"CNV Score",dataIndex:"cnv_score",sorter:(e,t)=>{var n,r;return(null!==(n=e.cnv_score)&&void 0!==n?n:-1/0)-(null!==(r=t.cnv_score)&&void 0!==r?r:-1/0)},align:"center",render:e=>null!=e?e:"--"},{title:"CNV Status",dataIndex:"cnv_status",sorter:(e,t)=>{var n,r;return null===(r=e.cnv_status)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cnv_status)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Malignancy",dataIndex:"malignancy",sorter:(e,t)=>{var n,r;return null===(r=e.malignancy)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.malignancy)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Cell Label",dataIndex:"cell_label",sorter:(e,t)=>{var n,r;return null===(r=e.cell_label)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cell_label)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"}],I=e=>{let{dataset:t}=e,{samples:n,isLoading:a,isError:l}=N(t.name);return a?(0,r.jsx)(c.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):l?(0,r.jsx)(d.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px",borderBottom:"2px solid #e0e0e0",mb:"36px",paddingBottom:"12px"},children:"Cells List"}),(0,r.jsx)(L.k,{columns:z,rowKey:e=>e.cell_id,dataSource:n,scroll:{x:"max-content"}})]})},E=[{title:"Spot ID",dataIndex:"spot_id",sorter:(e,t)=>{var n,r;return null===(r=e.spot_id)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.spot_id)||void 0===n?void 0:n.toLowerCase())},fixed:"left",align:"center",render:e=>(0,r.jsx)(m.Z,{value:e,color:"volcano"})},{title:"Dataset Name",dataIndex:"dataset_name",sorter:(e,t)=>{var n,r;return null===(r=e.dataset_name)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.dataset_name)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Cell Type",dataIndex:"cell_type",sorter:(e,t)=>{var n,r;return null===(r=e.cell_type)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cell_type)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Confidence",dataIndex:"confidence",sorter:(e,t)=>{var n,r;return null===(r=e.confidence)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.confidence)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Donor",dataIndex:"donor",sorter:(e,t)=>{var n,r;return null===(r=e.donor)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.donor)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"CNV Score",dataIndex:"cnv_score",sorter:(e,t)=>{var n,r;return(null!==(n=e.cnv_score)&&void 0!==n?n:-1/0)-(null!==(r=t.cnv_score)&&void 0!==r?r:-1/0)},align:"center",render:e=>null!=e?e:"--"},{title:"CNV Status",dataIndex:"cnv_status",sorter:(e,t)=>{var n,r;return null===(r=e.cnv_status)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cnv_status)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Malignancy",dataIndex:"malignancy",sorter:(e,t)=>{var n,r;return null===(r=e.malignancy)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.malignancy)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Cell Label",dataIndex:"cell_label",sorter:(e,t)=>{var n,r;return null===(r=e.cell_label)||void 0===r?void 0:r.toLowerCase().localeCompare(null===(n=t.cell_label)||void 0===n?void 0:n.toLowerCase())},align:"center",render:e=>e||"--"},{title:"Spatial 1",dataIndex:"spatial_1",sorter:(e,t)=>{var n,r;return(null!==(n=e.spatial_1)&&void 0!==n?n:-1/0)-(null!==(r=t.spatial_1)&&void 0!==r?r:-1/0)},align:"center",render:e=>null!=e?e:"--"},{title:"Spatial 2",dataIndex:"spatial_2",sorter:(e,t)=>{var n,r;return(null!==(n=e.spatial_2)&&void 0!==n?n:-1/0)-(null!==(r=t.spatial_2)&&void 0!==r?r:-1/0)},align:"center",render:e=>null!=e?e:"--"}],H=e=>{let{dataset:t}=e,{samples:n,isLoading:a,isError:l}=N(t.name);return a?(0,r.jsx)(c.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):l?(0,r.jsx)(d.Z,{containerSx:{height:"40vh",marginTop:"40px"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px",borderBottom:"2px solid #e0e0e0",mb:"36px",paddingBottom:"12px"},children:"Cells List"}),(0,r.jsx)(L.k,{columns:E,rowKey:e=>e.spot_id,dataSource:n,scroll:{x:"max-content"}})]})};var F=n(7294),Y=n(530),B=n(2492),W=n(3721);let{Text:K}=Y.default,{Option:O}=B.default;var D=e=>{let{workflow:t,selectedWorkflow:n,handleSelectedWorkflowChange:a}=e;return(0,r.jsxs)(W.Z,{style:{width:"100%"},title:(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px",mt:"12px",mb:"12px"},children:"Workflow Selector"}),children:[(0,r.jsx)(K,{type:"secondary",style:{fontSize:"20px"},children:"Select a workflow to view CNA features."}),(0,r.jsx)(B.default,{style:{width:"100%",marginTop:16},placeholder:"Please select a contig",onChange:a,value:n,size:"large",children:(t?t.split(","):["NA"]).map(e=>(0,r.jsx)(O,{value:e,style:{fontSize:"16px"},children:e},e))})]})};let U=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.$V)(e,t),i._);return{matrix:n,isMatrixLoading:a,isMatrixError:r,mutate:s}},V=(0,F.createContext)({width:0,height:0}),G=()=>(0,F.useContext)(V);var X=e=>{let{containerSx:t,children:n}=e,[a,l]=(0,F.useState)({width:0,height:0}),o=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=o.current,t=new ResizeObserver(e=>{for(let t of e){let{width:e,height:n}=t.contentRect;l({width:e,height:n})}});return e&&t.observe(e),()=>{e&&t.unobserve(e)}},[]),(0,r.jsx)(f.Z,{ref:o,sx:{width:"100%",...t},children:(0,r.jsx)(V.Provider,{value:a,children:n})})},q=e=>{let{children:t}=e;return(0,r.jsx)(X,{containerSx:{minHeight:"920px",boxShadow:"0 0 10px rgba(0, 0, 0, 0.1)",overflowX:"auto",scrollbarColor:"#eaeaea transparent","&::-webkit-scrollbar":{height:"6px"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#eaeaea",borderRadius:"4px"},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"}},children:t})};let J=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.gS)(e,t),i._);return{meta:n,isMetaLoading:a,isMetaError:r,mutate:s}},$=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.l$)(e,t),i._);return{tree:n,isTreeLoading:a,isTreeError:r,mutate:s}};var Q=n(2904),ee=n(4953),et=n(7489);let en=e=>{let{title:t,config:n,configKey:a,configSubKey:l,handleConfigChange:o,min:i=0,step:s=.1}=e;return(0,r.jsxs)(x.Z,{spacing:1,children:[(0,r.jsx)(f.Z,{sx:{fontWeight:500},children:t}),(0,r.jsx)(et.Z,{min:i,value:n[a][l],onChange:e=>{o(a,l,e)},size:"large",step:s,style:{width:"240px"}})]})};var er=n(6163);let ea=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsx)(en,{title:"Padding Top:",config:t,configKey:n,configSubKey:"paddingTop",handleConfigChange:a})},el=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Width:",config:t,configKey:n,configSubKey:"width",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin To HeatMap:",config:t,configKey:n,configSubKey:"marginToHeatMap",handleConfigChange:a})]})},eo=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Block Width:",config:t,configKey:n,configSubKey:"blockWidth",handleConfigChange:a}),(0,r.jsx)(en,{title:"Block Height:",config:t,configKey:n,configSubKey:"blockHeight",handleConfigChange:a}),(0,r.jsx)(en,{title:"Block Gap:",config:t,configKey:n,configSubKey:"blockGap",handleConfigChange:a}),(0,r.jsx)(en,{title:"Chromosome Legend Height:",config:t,configKey:n,configSubKey:"chromosomeLegendHeight",handleConfigChange:a})]})},ei=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsx)(en,{title:"Width:",config:t,configKey:n,configSubKey:"width",handleConfigChange:a})},es=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Width:",config:t,configKey:n,configSubKey:"width",handleConfigChange:a}),(0,r.jsx)(en,{title:"Height:",config:t,configKey:n,configSubKey:"height",handleConfigChange:a})]})},ec=(e,t)=>[{key:"chart",label:"Chart Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(ea,{config:e,configKey:"chart",handleConfigChange:t})},{key:"tree",label:"Tree Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(el,{config:e,configKey:"tree",handleConfigChange:t})},{key:"heatmap",label:"Heatmap Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(eo,{config:e,configKey:"heatmap",handleConfigChange:t})},{key:"meta",label:"Meta Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(ei,{config:e,configKey:"meta",handleConfigChange:t})},{key:"nodeHistory",label:"Node History Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(es,{config:e,configKey:"nodeHistory",handleConfigChange:t})}];var ed=e=>{let{config:t,handleConfigChange:n}=e,[a,l]=(0,F.useState)(["chart","tree","heatmap"]),o=(0,F.useMemo)(()=>ec(t,n),[t,n]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:o,activeKey:a,onChange:e=>{l(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})},eh=n(3750),eg=n(9792);let ex={chr1:248956422,chr2:242193529,chr3:198295559,chr4:190214555,chr5:181538259,chr6:170805979,chr7:159345973,chr8:145138636,chr9:138394717,chr10:133797422,chr11:135086622,chr12:133275309,chr13:114364328,chr14:107043718,chr15:101991189,chr16:90338345,chr17:83257441,chr18:80373285,chr19:58617616,chr20:64444167,chr21:46709983,chr22:50818468,chrX:156040895,chrY:57227415},ef={chr1:0,chr2:248956422,chr3:491149951,chr4:689445510,chr5:879660065,chr6:1061198324,chr7:1232004303,chr8:1391350276,chr9:1536488912,chr10:1674883629,chr11:1808681051,chr12:1943767673,chr13:2077042982,chr14:2191407310,chr15:2298451028,chr16:2400442217,chr17:2490780562,chr18:2574038003,chr19:2654411288,chr20:2713028904,chr21:2777473071,chr22:2824183054,chrX:2875001522,chrY:3031042417},eu={248956422:"chr1",491149951:"chr2",689445510:"chr3",879660065:"chr4",1061198324:"chr5",1232004303:"chr6",1391350276:"chr7",1536488912:"chr8",1674883629:"chr9",1808681051:"chr10",1943767673:"chr11",2077042982:"chr12",2191407310:"chr13",2298451028:"chr14",2400442217:"chr15",2490780562:"chr16",2574038003:"chr17",2654411288:"chr18",2713028904:"chr19",2777473071:"chr20",2824183054:"chr21",2875001522:"chr22",3031042417:"chrX",3088269832:"chrY"},ep={chr1:[0,248956422],chr2:[248956422,491149951],chr3:[491149951,689445510],chr4:[689445510,879660065],chr5:[879660065,1061198324],chr6:[1061198324,1232004303],chr7:[1232004303,1391350276],chr8:[1391350276,1536488912],chr9:[1536488912,1674883629],chr10:[1674883629,1808681051],chr11:[1808681051,1943767673],chr12:[1943767673,2077042982],chr13:[2077042982,2191407310],chr14:[2191407310,2298451028],chr15:[2298451028,2400442217],chr16:[2400442217,2490780562],chr17:[2490780562,2574038003],chr18:[2574038003,2654411288],chr19:[2654411288,2713028904],chr20:[2713028904,2777473071],chr21:[2777473071,2824183054],chr22:[2824183054,2875001522],chrX:[2875001522,3031042417],chrY:[3031042417,3088269832]},em=[1,3088269832],ej=[1,2875001522],ey={chr1:249250621,chr2:243199373,chr3:198022430,chr4:191154276,chr5:180915260,chr6:171115067,chr7:159138663,chr8:146364022,chr9:141213431,chr10:135534747,chr11:135006516,chr12:133851895,chr13:115169878,chr14:107349540,chr15:102531392,chr16:90354753,chr17:81195210,chr18:78077248,chr19:59128983,chr20:63025520,chr21:48129895,chr22:51304566,chrX:155270560,chrY:59373566},ev={chr1:0,chr2:249250621,chr3:492449994,chr4:690472424,chr5:881626700,chr6:1062541960,chr7:1233657027,chr8:1392795690,chr9:1539159712,chr10:1680373143,chr11:1815907890,chr12:1950914406,chr13:2084766301,chr14:2199936179,chr15:2307285719,chr16:2409817111,chr17:2500171864,chr18:2581367074,chr19:2659444322,chr20:2718573305,chr21:2781598825,chr22:2829728720,chrX:2881033286,chrY:3036303846},eC={249250621:"chr1",492449994:"chr2",690472424:"chr3",881626700:"chr4",1062541960:"chr5",1233657027:"chr6",1392795690:"chr7",1539159712:"chr8",1680373143:"chr9",1815907890:"chr10",1950914406:"chr11",2084766301:"chr12",2199936179:"chr13",2307285719:"chr14",2409817111:"chr15",2500171864:"chr16",2581367074:"chr17",2659444322:"chr18",2718573305:"chr19",2781598825:"chr20",2829728720:"chr21",2881033286:"chr22",3036303846:"chrX",3095677412:"chrY"},ew={chr1:[0,249250621],chr2:[249250621,492449994],chr3:[492449994,690472424],chr4:[690472424,881626700],chr5:[881626700,1062541960],chr6:[1062541960,1233657027],chr7:[1233657027,1392795690],chr8:[1392795690,1539159712],chr9:[1539159712,1680373143],chr10:[1680373143,1815907890],chr11:[1815907890,1950914406],chr12:[1950914406,2084766301],chr13:[2084766301,2199936179],chr14:[2199936179,2307285719],chr15:[2307285719,2409817111],chr16:[2409817111,2500171864],chr17:[2500171864,2581367074],chr18:[2581367074,2659444322],chr19:[2659444322,2718573305],chr20:[2718573305,2781598825],chr21:[2781598825,2829728720],chr22:[2829728720,2881033286],chrX:[2881033286,3036303846],chrY:[3036303846,3095677412]},eb=[1,3095677412],eS=[1,2881033286],e_=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hg38",n=[];for(let[r,a]of Object.entries("hg19"===t?ey:ex)){let t=Math.floor(a/e)+1;n.push([r,t])}return n},eZ=e=>e.replace("chr",""),ek=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eZ,n=t(e);return isNaN(n)?"X"===n?23:"Y"===n?24:void 0:parseInt(n,10)},eA=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"asc",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eZ;return"desc"===e?(e,n)=>ek(n,t)-ek(e,t):(e,n)=>ek(e,t)-ek(n,t)};var eN=n(4735),eL=n(7460),eT=n(6486),eP=n.n(eT),eM=e=>{for(var t=[],n={},r=e.split(/\s*(;|\(|\)|,|:)\s*/),a=0;a<r.length;a++){var l=r[a];switch(l){case"(":var o={};n.children=[o],t.push(n),n=o;break;case",":var o={};t[t.length-1].children.push(o),n=o;break;case")":n=t.pop();break;case":":break;default:var i=r[a-1];")"===i||"("===i||","===i?n.name=l:":"===i&&(n.length=parseFloat(l))}}return n};let eR=(e,t)=>{let n=e[0].slice(1,e[0].length),r=e.slice(1,e.length).map(e=>e.map((e,t)=>0===t?e:parseFloat(e))),a={};for(let e=0;e<r.length;e++){let t=r[e];a[t[0]]=t.slice(1,t.length)}let l={};for(let e in t)l[e]=n.slice(parseInt(t[e][0]),parseInt(t[e][1]));return{binIndex:l,CNVMatrixObject:a}},ez=e=>/^-?\d+(\.\d+)?$/.test(e),eI=["e_PCA1","e_PCA2","e_TSNE1","e_TSNE2","e_UMAP1","e_UMAP2"],eE=e=>{let t=e[0],n=[0,...eI.map(e=>t.indexOf(e)).filter(e=>-1!==e)],r=e.map(e=>n.map(t=>e[t])),a=r[0],l=r.slice(1,r.length).map(e=>e.map((e,t)=>ez(e)&&"hcluster"!==a[t]?parseFloat(e):e)),o=eP().zip(...l),i={};for(let e=1;e<a.length;e++)if("string"==typeof o[e][0])i[a[e]]=[...new Set(o[e])];else{let t=eP().ceil(eP().max(o[e]),0),n=eP().floor(eP().min(o[e]),0);i[a[e]]=[-0===n?0:n,-0===t?0:t]}let s={};for(let e=0;e<l.length;e++){let t=l[e];s[t[0]]=t.slice(1,t.length)}return{metaRanges:i,CNVMetaObject:s,metaHeaders:a.slice(1,a.length)}},eH=e=>{let t={};for(let n=0;n<e.length;n++)t[e[n][0]]=0===n?[0,e[n][1]]:[t[e[n-1][0]][1],t[e[n-1][0]][1]+e[n][1]];return t},eF=(e,t,n,r)=>{let a=JSON.parse(e),{binIndex:l,CNVMatrixObject:o}=eR(t=eL.parse(t,{skipEmptyLines:!0}).data,r),i=Object.keys(o).length,{metaRanges:s,CNVMetaObject:c,metaHeaders:d}=eE(n=eL.parse(n,{skipEmptyLines:!0}).data);return{CNVCutObject:a,binIndex:l,CNVMatrixObject:o,totalFileNum:i,metaRanges:s,CNVMetaObject:c,metaHeaders:d}},eY=(e,t)=>{let n=[["chr1",0,t*e[0][1]]];for(let r=1;r<e.length;r++)n.push([e[r][0],e[r-1][1]*t+n[r-1][1],t*e[r][1]]);return n},eB=(e,t)=>{let n=eN.bT9(eM(e),e=>e.children).sum(e=>e.children?0:1).children[0],r=t/(n.height+1),a=eN.ki8().nodeSize([10,r]);return n.sort((e,t)=>eN.j2p(e.data.name,t.data.name)),a(n),n},eW=(e,t)=>{let n=t.leaves(),r={};for(let t of n)r[t.data.name]=e[t.data.name].leafs;return r},eK=(e,t,n)=>{let r={};for(let a of Object.keys(t)){let l=Object.values(eP().pick(e,t[a])),o=eP().zip(...l).map(e=>eP().mean(e)),i={};for(let e in n)i[e]=o.slice(n[e][0],n[e][1]);r[a]={fileNum:l.length,CNVAvg:i}}let a=Object.keys(r);for(let e=0;e<a.length;e++)r[a[e]].offset=0===e?0:r[a[e-1]].offset+r[a[e-1]].fileNum;return r},eO=(e,t)=>{let n={};for(let r of Object.keys(t))n[r]=eP().pick(e,t[r]);return n},eD=(e,t,n)=>{let r={},a=Object.keys(t);for(let e=0;e<a.length;e++)r[e]=0===e?0:t[a[e-1]].length+r[e-1];let l=e.leaves();for(let e=0;e<l.length;e++)l[e].x=(r[e]+t[a[e]].length/2)*n;for(let t of e.descendants().reverse())t.children&&(t.x=(t.children[1].x+t.children[0].x)/2)},eU=(e,t)=>{let n;n=0===t?[-1,1]:[0,10];let r=eN.cJy().domain([n[0],t]).interpolator(eN.LX0("#add8e6","#ffffff")).clamp(!0),a=eN.cJy().domain([t,n[1]]).interpolator(eN.LX0("#ffffff","#6A0220")).clamp(!0),l=eN.cJy().domain(e.e_PCA1).interpolator(eN.LX0("#c4a1d3","#ad49e1")),o=eN.cJy().domain(e.e_PCA2).interpolator(eN.LX0("#52b199","#0d7c66")),i=eN.cJy().domain(e.e_TSNE1).interpolator(eN.LX0("#d88f92","#c63c51")),s={CNVLow:r,CNVHigh:a,e_PCA1:l,e_PCA2:o,e_TSNE1:i,e_TSNE2:eN.cJy().domain(e.e_TSNE2).interpolator(eN.LX0("#bad9ff","#3572ef")),e_UMAP1:eN.cJy().domain(e.e_UMAP1).interpolator(eN.LX0("#ffa699","#ff7f3e")),e_UMAP2:eN.cJy().domain(e.e_UMAP2).interpolator(eN.LX0("#f0e8fa","#FF76CE"))};return{colorScales:s,getCNVColor:e=>e<t?s.CNVLow(e):s.CNVHigh(e)}},eV=e=>{let{color:t,title:n,tickSize:a=6,width:l=320,height:o=44+a,marginTop:i=18,marginRight:s=0,marginBottom:c=16+a,marginLeft:d=0,ticks:h=l/64,legendMarginTop:g,tickFormat:x,tickValues:f}=e,u=(0,F.useRef)(null),p=(0,F.useRef)(x),m=(0,F.useRef)(f);function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:256,n=document.createElement("canvas");n.width=t,n.height=1;let r=n.getContext("2d");for(let n=0;n<t;++n)r.fillStyle=e(n/(t-1)),r.fillRect(n,0,1,1);return n}return(0,F.useEffect)(()=>{let e;let r=eN.Ys(u.current);r.selectAll("*").remove(),r.attr("width",l).attr("height",o).style("overflow","visible").style("display","block");let g=e=>e.selectAll(".tick line").attr("y1",i+c-o);if(t.interpolate){let n=Math.min(t.domain().length,t.range().length);e=t.copy().rangeRound(eN.q$2(eN.sXR(d,l-s),n)),r.append("image").attr("x",d).attr("y",i).attr("width",l-d-s).attr("height",o-i-c).attr("preserveAspectRatio","none").attr("xlink:href",j(t.copy().domain(eN.q$2(eN.sXR(0,1),n))).toDataURL())}else if(t.interpolator){if(e=Object.assign(t.copy().interpolator(eN.uLU(d,l-s)),{range:()=>[d,l-s]}),r.append("image").attr("x",d).attr("y",i).attr("width",l-d-s).attr("height",o-i-c).attr("preserveAspectRatio","none").attr("xlink:href",j(t.interpolator()).toDataURL()),!e.ticks){if(void 0===m.current){let e=Math.round(h+1);m.current=eN.w6H(e).map(n=>eN.VRg(t.domain(),n/(e-1)))}"function"!=typeof p.current&&(p.current=eN.WUZ(void 0===p.current?",f":p.current))}}else if(t.invertExtent){let n=t.thresholds?t.thresholds():t.quantiles?t.quantiles():t.domain(),a=void 0===x?e=>e:"string"==typeof x?eN.WUZ(x):x;e=eN.BYU().domain([-1,t.range().length-1]).rangeRound([d,l-s]),r.append("g").selectAll("rect").data(t.range()).join("rect").attr("x",(t,n)=>e(n-1)).attr("y",i).attr("width",(t,n)=>e(n)-e(n-1)).attr("height",o-i-c).attr("fill",e=>e),m.current=eN.w6H(n.length),p.current=e=>a(n[e],e)}else e=eN.tiA().domain(t.domain()).rangeRound([d,l-s]),r.append("g").selectAll("rect").data(t.domain()).join("rect").attr("x",e).attr("y",i).attr("width",Math.max(0,e.bandwidth()-1)).attr("height",o-i-c).attr("fill",t),g=()=>{};r.append("g").attr("transform","translate(0,".concat(o-c,")")).call(eN.LLu(e).ticks(h,"string"==typeof x?x:void 0).tickFormat("function"==typeof x?x:void 0).tickSize(a).tickValues(f)).call(g).call(e=>e.select(".domain").remove()).call(e=>e.append("text").attr("x",d).attr("y",i+c-o-6).attr("fill","currentColor").attr("text-anchor","start").attr("font-weight","bold").attr("class","title").text(n))},[t,o,c,d,s,i,x,a,f,h,n,l]),(0,r.jsx)("g",{ref:u,transform:"translate(0, ".concat(g,")")})};var eG=e=>{let t,{width:n,marginTop:a,legendWidth:l,legendHeight:o,colorScales:i,baselineCNA:s}=e;t=0===s?[-1,1]:[0,10];let c=eN.PUr([t[0],s,t[1]],["#add8e6","#ffffff","#6A0220"]);return(0,r.jsxs)("g",{transform:"translate(".concat((n-l)/2,", ").concat(a,")"),children:[(0,r.jsx)(eV,{color:c,title:"CNV Value",width:l,legendMarginTop:0,ticks:t[1]-t[0]+1}),(0,r.jsx)(eV,{color:i.e_PCA1,title:"ePCA1",width:l,legendMarginTop:1*o}),(0,r.jsx)(eV,{color:i.e_PCA2,title:"ePCA2",width:l,legendMarginTop:2*o}),(0,r.jsx)(eV,{color:i.e_TSNE1,title:"e_TSNE1",width:l,legendMarginTop:3*o}),(0,r.jsx)(eV,{color:i.e_TSNE2,title:"e_TSNE2",width:l,legendMarginTop:4*o}),(0,r.jsx)(eV,{color:i.e_UMAP1,title:"e_UMAP1",width:l,legendMarginTop:5*o}),(0,r.jsx)(eV,{color:i.e_UMAP2,title:"e_UMAP2",width:l,legendMarginTop:6*o})]})},eX=n(3935);let eq=(0,F.forwardRef)(function(e,t){let[n,a]=(0,F.useState)({visible:!1,x:0,y:0,content:null});return(0,F.useImperativeHandle)(t,()=>({showTooltip:(e,t)=>{a({visible:!0,x:e.pageX,y:e.pageY,content:t})},hideTooltip:()=>{a({...n,visible:!1})}})),(0,r.jsxs)("div",{style:{position:"absolute",top:n.y-5,left:n.x,zIndex:1e3,display:n.visible?"block":"none",borderStyle:"solid",whiteSpace:"nowrap",boxShadow:"rgba(0, 0, 0, 0.2) 1px 2px 10px",backgroundColor:"rgb(255, 255, 255)",borderWidth:"1px",borderRadius:"4px",color:"rgb(102, 102, 102)",font:'14px / 21px "Microsoft YaHei"',padding:"10px",borderColor:"rgb(84, 112, 198)",pointerEvents:"none",transform:"translate(-50%, -100%)"},children:[n.content,(0,r.jsx)("div",{style:{position:"absolute",width:6,height:6,zIndex:-1,left:"50%",bottom:"-4.21px",transform:"translateX(-50%) rotate(225deg)",borderTop:"rgb(84, 112, 198) solid 1px",borderLeft:"rgb(84, 112, 198) solid 1px",backgroundColor:"#fff"}})]})});var eJ=n(858);let e$=e=>{let t=eN.bT9(eM(e),e=>e.children).sum(e=>e.children?0:1),n=0;return t.each(e=>{e.data.name||(e.data.name="n".concat(n++))}),eN.ki8().nodeSize([10,10])(t),t.data.length=0,eQ(t),t},eQ=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;e.data.distanceToRoot=t+e.data.length,e.children&&e.children.forEach(t=>{eQ(t,e.data.distanceToRoot)})},e0=(e,t,n,r,a,l,o,i)=>{let{middles:s,leaves:c}=e3(e,t),d=[],h={};for(let e of c){let t=e.leaves().map(e=>e.data.name);d.push(...t),h[e.data.name]=t}let g=i.metaRectWidth*r.length,x="Fixed"===i.mode?i.rectHeight*d.length:i.height,f=i.CNARectWidth*a.length,u=eN.tiA().domain(d).range([0,x]),p=eN.tiA().domain(r).range([0,g]),m=Object.fromEntries(Object.entries(n).filter(e=>{let[t,n]=e;return d.includes(t)}));e6(e,s,c,h,o.width,u);let j=eN.tiA().domain(a.map(e=>e.gene)).range([g,f+g]),y=e1(c);return{nodes:[...s,...c],leaves:c,yMeta:u,xMeta:p,filteredMeta:m,xMatrix:j,yMatrix:y,cutTreeCNVMatrix:e2(l,h)}},e1=e=>e.reduce((e,t)=>(e[t.data.name]={y:t.topX,height:t.bottomX-t.topX},e),{}),e2=(e,t)=>Object.entries(t).reduce((t,n)=>{let[r,a]=n,l=a.map(t=>e[t]);return t[r]=eP().zipWith(...l,function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e+t,0)/t.length}),t},{}),e6=(e,t,n,r,a,l)=>{for(let e of n){let t=r[e.data.name];e.topX=l(eP().head(t)),e.bottomX=l(eP().last(t))+l.bandwidth(),e.horizontalPosition=(e.topX+e.bottomX)/2}for(let e of t)e.horizontalPosition=(e.children[0].horizontalPosition+e.children[1].horizontalPosition)/2;let o=e4(e,n);e8(e,-e.data.length,0===o?1:a/o,n)},e3=(e,t)=>{let n=[],r=new eJ.lF((e,t)=>e.data.distanceToRoot-t.data.distanceToRoot);for(r.push(e);r.length!==t;){let e=r.pop();if(n.push(e),r.push(...e.children),void 0===r.peek().children)break}return{middles:n.reverse(),leaves:r.toArray().sort((e,t)=>t.x-e.x)}},e4=(e,t)=>e.data.length+(t.includes(e)?0:eN.Fp7(e.children,e=>e4(e,t))),e8=(e,t,n,r)=>{e.verticalPosition=(t+=e.data.length)*n,r.includes(e)||e.children.forEach(e=>e8(e,t,n,r))},e5=e=>e.data.length+(e.children?eN.Fp7(e.children,e5):0),e9=(e,t,n)=>{e.verticalPosition=(t+=e.data.length)*n,e.children&&e.children.forEach(e=>{e9(e,t,n)})},e7=e=>"M ".concat(e.source.verticalPosition," ").concat(e.source.x," V ").concat(e.target.x," H ").concat(e.target.verticalPosition),te=e=>"translate(".concat(e.verticalPosition,", ").concat(e.x,")"),tt=e=>"M ".concat(e.source.verticalPosition," ").concat(e.source.horizontalPosition," V ").concat(e.target.horizontalPosition," H ").concat(e.target.verticalPosition),tn=e=>"translate(".concat(e.verticalPosition,", ").concat(e.horizontalPosition,")"),tr=(e,t,n,a)=>(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)("div",{style:{fontSize:18,textAlign:"center",color:"#666",fontWeight:800,lineHeight:"1.5"},children:e}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{display:"inline-block",marginRight:4,borderRadius:10,width:10,height:10,backgroundColor:t}}),(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:n}),(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:"string"==typeof a?a:eP().round(a,3)}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),ta=e=>(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:e}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),tl=(e,t,n,a)=>(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)("div",{style:{fontSize:18,textAlign:"center",color:"#666",fontWeight:800,lineHeight:"1.5"},children:e}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:"Parent Node:"}),(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:t}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:"Number of CNV Files:"}),(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:n}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:"Distance to Root:"}),(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:eP().round(a,3)}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),to=e=>{e.attr("opacity",.1)},ti=e=>{e.attr("opacity",1)};var ts=e=>{let{marginLeft:t,paddingTop:n,width:a,root:l,CNVCut:o,goToTreeNode:i,showTooltip:s,hideTooltip:c}=e,d=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=eN.Ys(d.current),t=eN.Ys(".heatMapContainer");e9(l,l.data.length=0,a/e5(l));let n=e.select(".links");n.empty()&&(n=e.append("g").attr("class","links").attr("fill","none").attr("stroke","#000000"));let r=e.select(".nodes");r.empty()&&(r=e.append("g").attr("class","nodes").attr("cursor","pointer").attr("pointer-events","all")),n.selectAll("path").data(l.links()).join("path").attr("d",e7),r.selectAll("g").data(l.descendants(),e=>e.data.name).join(e=>{e.append("g").attr("transform",te).append("circle").attr("r",4).each(function(e){let n=e.data.name,r=o[n];e.children?eN.Ys(this).on("mouseenter",e=>{s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))}).on("mouseout",()=>{c()}).on("mousemove",e=>s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))):eN.Ys(this).on("mouseenter",e=>{to(t.selectAll(".chromosome").filter(e=>e!==n)),s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))}).on("mouseout",()=>{c(),ti(t.selectAll(".chromosome").filter(e=>e!==n))}).on("mousemove",e=>s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))),1===o[e.data.name].leafs.length?eN.Ys(this).attr("fill","#999"):eN.Ys(this).attr("fill","#333").on("click",function(e,t){i(t.data.name)})})},e=>{e.attr("transform",te).each(function(e){let n=e.data.name,r=o[n];e.children?eN.Ys(this).on("mouseenter",e=>{s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))}).on("mouseout",()=>{c()}).on("mousemove",e=>s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))):eN.Ys(this).on("mouseenter",e=>{to(t.selectAll(".chromosome").filter(e=>e!==n)),s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))}).on("mouseout",()=>{c(),ti(t.selectAll(".chromosome").filter(e=>e!==n))}).on("mousemove",e=>s(e,tl(n,r.parent,r.leafs.length,r.dist_to_root))),1===o[e.data.name].leafs.length?eN.Ys(this).select("circle").attr("fill","#999"):eN.Ys(this).select("circle").attr("fill","#333").on("click",function(e,r){ti(t.selectAll(".chromosome").filter(e=>e!==n)),i(r.data.name)})})},e=>{e.transition().duration(500).attr("fill-opacity",0).remove()})},[o,i,c,l,s,a]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("g",{ref:d,transform:"translate(".concat(t,", ").concat(n,")")})})};let tc=(e,t,n,r,a,l,o,i,s)=>{let c=r*a*4,d=n.selectAll(".chromosome").selectAll("g"),h=d.filter(function(t){return t===e}),g=d.filter(function(e){return t.includes(e)}),x=i.selectAll("g").filter(function(e){return t.includes(e[0])});parseFloat(h.select("rect").attr("width"))!==a-s?(g.each(function(){let e=parseFloat(eN.Ys(this).attr("transform").match(/translate\(([\d.]+), 0\)/)[1]);eN.Ys(this).attr("transform","translate(".concat(e-c,", 0)"))}),h.selectAll("rect").attr("width",a-s).attr("x",(e,t)=>t*a),eN.Ys(o).select("rect").attr("width",r*a),eN.Ys(o).select("text").attr("x",r*a/2),x.each(function(){let e=parseFloat(eN.Ys(this).attr("transform").match(/translate\(([\d.]+), 0\)/)[1]);eN.Ys(this).attr("transform","translate(".concat(e-c,", 0)"))})):(g.each(function(){let e=parseFloat(eN.Ys(this).attr("transform").match(/translate\(([\d.]+), 0\)/)[1]);eN.Ys(this).attr("transform","translate(".concat(e+c,", 0)"))}),h.selectAll("rect").attr("width",5*a-s).attr("x",(e,t)=>5*t*a),eN.Ys(o).select("rect").attr("width",5*r*a),eN.Ys(o).select("text").attr("x",5*r*a/2),x.each(function(){let e=parseFloat(eN.Ys(this).attr("transform").match(/translate\(([\d.]+), 0\)/)[1]);eN.Ys(this).attr("transform","translate(".concat(e+c,", 0)"))}))};var td=e=>{let{marginLeft:t,paddingTop:n,metaOffset:a,chromosomeLegendHeight:l,blockWidth:o,blockGap:i,metaWidth:s,headerBlockOffset:c,CNVMatrixMeta:d,metaHeaders:h,showTooltip:g,hideTooltip:x}=e,f=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=eN.Ys(f.current),t=eN.Ys(".heatMapContainer"),n=d.map(e=>e[0]),r=d.map(e=>e[1]),u=e.select(".chromosomeHeader");u.empty()&&(u=e.append("g").attr("class","chromosomeHeader")),u.selectAll("g").data(c).join(e=>{u.attr("transform","translate(".concat(a,", 0)"));let s=e.append("g").attr("transform",e=>"translate(".concat(e[1],", 0)"));s.append("rect").attr("width",e=>e[2]).attr("height",l).attr("fill",(e,t)=>t%2==0?"#c6c6c6":"#303030").attr("cursor","pointer").attr("pointer-events","all").each(function(e){let t=eP().replace(e[0],"chr","Chromosome");eN.Ys(this).on("mouseenter",e=>g(e,ta(t))).on("mousemove",e=>g(e,ta(t))).on("mouseout",x)}).on("click",function(e,a){let l=a[0],s=n.slice(n.indexOf(l)+1,n.length),c=r[n.indexOf(l)];tc(l,s,t,c,o,a,this.parentNode,u,i)}),s.append("text").attr("x",e=>e[2]/2).attr("y",l/2).attr("pointer-events","none").attr("text-anchor","middle").attr("dy",".35em").text(e=>e[0].slice(3,e[0].length)).attr("fill",(e,t)=>t%2==0?"#000000":"#ffffff")},e=>{u.attr("transform","translate(".concat(a,", 0)")),e.each(function(){let e=eN.Ys(this).attr("transform",e=>"translate(".concat(e[1],", 0)"));e.select("rect").attr("width",e=>e[2]).attr("height",l).on("click",function(e,a){let l=a[0],s=n.slice(n.indexOf(l)+1,n.length),c=r[n.indexOf(l)];tc(l,s,t,c,o,a,this.parentNode,u,i)}),e.select("text").attr("x",e=>e[2]/2).attr("y",l/2)})});let p=e.select(".metaHeader");p.empty()?p=e.append("g").attr("class","metaHeader").attr("transform","translate(0, ".concat(l,")")):p.attr("transform","translate(0, ".concat(l,")")),p.selectAll("text").data(h).join(e=>{e.append("text").attr("dy","0.3em").attr("font-size","12").attr("font-family","sans-serif").attr("transform",(e,t)=>"rotate(-90) translate(4, ".concat(s*t,")")).text(e=>e.split("_").pop())},e=>{p.selectAll("text").attr("transform",(e,t)=>"rotate(-90) translate(4, ".concat(s*t+s/2,")"))})},[d,i,o,l,c,x,h,a,s,g]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("g",{ref:f,transform:"translate(".concat(t,", ").concat(n,")")})})},th=e=>{let{marginLeft:t,paddingTop:n,blockHeight:a,blockWidth:l,metaWidth:o,metaOffset:i,colorScales:s,blockGap:c,leaves:d,CNVClusterMeanMatrix:h,clusterMetaDict:g,metaNameList:x,headerBlockOffset:f,binIndex:u,getCNVColor:p,showTooltip:m,hideTooltip:j}=e,y=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=eN.Ys(y.current).selectAll(":scope > g").data(d).join("g").attr("transform",e=>"translate(0, ".concat(h[e].offset*a,")"));e.each(function(e){let t=eN.Ys(this).select(".metaInfo");t.empty()&&(t=eN.Ys(this).append("g").attr("class","metaInfo")),t.selectAll("g").data(Object.keys(g[e])).join("g").attr("transform",(e,t)=>"translate(0, ".concat(t*a,")")).each(function(t){eN.Ys(this).selectAll("rect").data(t=>g[e][t]).join("rect").attr("x",(e,t)=>o*t).attr("width",o-c).attr("height",a-c).attr("fill",(e,t)=>s[x[t]](e)).each(function(e,n){eN.Ys(this).on("mouseenter",r=>m(r,tr(t,s[x[n]](e),x[n],e))).on("mousemove",r=>m(r,tr(t,s[x[n]](e),x[n],e))).on("mouseout",j)})})}),e.each(function(e){let t=h[e],n=t.fileNum,r=eN.Ys(this).select(".chromosome");r.empty()&&(r=eN.Ys(this).append("g").attr("class","chromosome")),r.selectAll("g").data(Object.keys(t.CNVAvg)).join("g").attr("transform",(e,t)=>"translate(".concat(i+f[t][1],", 0)")).each(function(r){eN.Ys(this).selectAll("rect").data(t.CNVAvg[r]).join("rect").each(function(t,o){eN.Ys(this).attr("x",o*l).attr("width",l-c).attr("height",a*n-c).attr("fill",e=>p(e)).on("mouseenter",n=>m(n,tr(e,p(t),u[r][o],t))).on("mousemove",n=>m(n,tr(e,p(t),u[r][o],t))).on("mouseout",j)})})})},[h,u,c,a,l,g,s,p,f,j,d,t,x,i,o,m]),(0,r.jsx)(r.Fragment,{children:(0,r.jsx)("g",{ref:y,transform:"translate(".concat(t,", ").concat(n,")"),className:"heatMapContainer"})})},tg=e=>{let{buttonWidth:t,buttonHeight:n,marginLeft:a,paddingTop:l,currentNodeIndex:o,nodeHistoryList:i,goBackRoot:s,goForwardNode:c,goBackNode:d}=e;return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("g",{transform:"translate(".concat(a,", ").concat(l,")"),children:[(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{width:2*t+4,height:n,fill:0===o?"#AAE3D8":"#41B3A2",rx:5,ry:5,cursor:0===o?"not-allowed":"pointer",onClick:0===o?null:s}),(0,r.jsx)("text",{fontSize:10,x:t+2,y:n/2,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",pointerEvents:"none",children:"Back To Root"})]}),(0,r.jsxs)("g",{transform:"translate(0, ".concat(n+4,")"),children:[(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{width:t,height:n,fill:0===o?"#AAE3D8":"#41B3A2",rx:5,ry:5,cursor:0===o?"not-allowed":"pointer",onClick:0===o?null:d}),(0,r.jsx)("text",{fontSize:10,x:t/2,y:n/2,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",pointerEvents:"none",children:"Prev"})]}),(0,r.jsxs)("g",{transform:"translate(".concat(t+4,", 0)"),children:[(0,r.jsx)("rect",{width:t,height:n,fill:o===i.length-1?"#AAE3D8":"#41B3A2",rx:5,ry:5,cursor:o===i.length-1?"not-allowed":"pointer",onClick:o===i.length-1?null:c}),(0,r.jsx)("text",{fontSize:10,x:t/2,y:n/2,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",pointerEvents:"none",children:"Next"})]})]})]})})};function tx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"download.svg",n=new Blob([new XMLSerializer().serializeToString(e)],{type:"image/svg+xml;charset=utf-8"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=t,a.click(),URL.revokeObjectURL(r)}let tf=(0,F.forwardRef)((e,t)=>{let{matrix:n,meta:a,tree:l,baselineCNA:o,reference:i,binStep:s=5e6,config:c,isShowLeft:d,handleIsShowLeftChange:h}=e,g=(0,F.useRef)(null),x=(0,F.useRef)(null),u=(0,F.useRef)(null),[p,m]=(0,F.useState)(["n0"]),[j,y]=(0,F.useState)(0),v=e_(s,i),C=eH(v),w=(0,F.useMemo)(()=>eF(l,n,a,C),[C,n,a,l]),b=(0,F.useMemo)(()=>eY(v,c.heatmap.blockWidth),[v,c.heatmap.blockWidth]),{colorScales:S,getCNVColor:_}=eU(w.metaRanges,o),Z=c.meta.width*Object.values(w.CNVMetaObject)[0].length,k=eB(w.CNVCutObject[p[j]].newick,c.tree.width),A=eW(w.CNVCutObject,k),N=eK(w.CNVMatrixObject,A,C);Object.values(N).reduce((e,t)=>e+t.fileNum,0);let L=k.leaves().map(e=>e.data.name),T=eO(w.CNVMetaObject,A);eD(k,A,c.heatmap.blockHeight);let P=(e,t)=>{u.current.showTooltip(e,t)},M=()=>{u.current.hideTooltip()};return(0,F.useEffect)(()=>{let e=eN.sPX().scaleExtent([.1,10]).on("zoom",function(e){eN.Ys(x.current).attr("transform",e.transform)});eN.Ys(g.current).call(e)},[]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{g.current&&tx(g.current,"Bin-Level_CNA_Heatmap.svg")}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:d,handleIsShowLeftChange:h,title:"Setting Options"})}),(0,r.jsx)("svg",{ref:g,width:"100%",height:"100%",children:(0,r.jsxs)("g",{ref:x,children:[(0,r.jsx)(eG,{width:c.legend.width,marginTop:c.legend.marginTop,legendWidth:c.legend.legendWidth,legendHeight:c.legend.legendHeight,colorScales:S,baselineCNA:o}),(0,r.jsx)(th,{marginLeft:c.tree.width+c.tree.marginToHeatMap+c.legend.width,paddingTop:c.chart.paddingTop+c.heatmap.chromosomeLegendHeight,blockHeight:c.heatmap.blockHeight,blockWidth:c.heatmap.blockWidth,metaWidth:c.meta.width,metaOffset:Z,colorScales:S,blockGap:c.heatmap.blockGap,leaves:L,CNVClusterMeanMatrix:N,clusterMetaDict:T,metaNameList:w.metaHeaders,headerBlockOffset:b,binIndex:w.binIndex,getCNVColor:_,showTooltip:P,hideTooltip:M}),(0,r.jsx)(tg,{buttonWidth:c.nodeHistory.width,buttonHeight:c.nodeHistory.height,marginLeft:.85*c.tree.width-2*c.nodeHistory.width+c.legend.width,paddingTop:c.chart.paddingTop+c.heatmap.chromosomeLegendHeight-2*c.nodeHistory.height-4,currentNodeIndex:j,nodeHistoryList:p,goBackNode:()=>{j>0&&y(j-1)},goForwardNode:()=>{j<p.length-1&&y(j+1)},goBackRoot:()=>{m(["n0"]),y(0)}}),(0,r.jsx)(ts,{marginLeft:c.legend.width,paddingTop:c.chart.paddingTop+c.heatmap.chromosomeLegendHeight,width:c.tree.width,root:k,CNVCut:w.CNVCutObject,goToTreeNode:e=>{m([...p.slice(0,j+1),e]),y(j+1)},showTooltip:P,hideTooltip:M}),(0,r.jsx)(td,{marginLeft:c.tree.width+c.tree.marginToHeatMap+c.legend.width,paddingTop:c.chart.paddingTop,metaOffset:Z,chromosomeLegendHeight:c.heatmap.chromosomeLegendHeight,blockWidth:c.heatmap.blockWidth,blockGap:c.heatmap.blockGap,metaWidth:c.meta.width,headerBlockOffset:b,CNVMatrixMeta:v,metaHeaders:w.metaHeaders,showTooltip:P,hideTooltip:M})]})}),(0,eX.createPortal)((0,r.jsx)(eq,{ref:u}),document.body)]})});tf.displayName="CNAChromosomeHeatmapPanel";var tu=e=>{let{matrix:t,meta:n,tree:a,baselineCNA:l,reference:o,vizRef:i}=e,[s,c]=(0,F.useState)(!0),[d,h]=(0,F.useState)({chart:{paddingTop:40},tree:{width:300,marginToHeatMap:20},heatmap:{blockWidth:2,defaultHeight:6,blockHeight:10,blockGap:.1,chromosomeLegendHeight:25},meta:{width:16},nodeHistory:{width:35,height:20},legend:{marginTop:50,width:350,legendWidth:250,legendHeight:45}});return(0,r.jsx)(eh.Z,{isShowLeft:s,leftPanelWidth:300,leftPanel:(0,r.jsx)(ed,{config:d,handleConfigChange:(e,t,n)=>{h(r=>({...r,[e]:{...r[e],[t]:n}}))}}),rightPanel:(0,r.jsx)(tf,{matrix:t,meta:n,tree:a,baselineCNA:l,reference:o,config:d,isShowLeft:s,handleIsShowLeftChange:()=>{c(!s)},ref:i})})},tp=n(8514),tm=n(1218);let tj=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{matrix:l,isMatrixLoading:o,isMatrixError:i}=U(n.name,t),{meta:s,isMetaLoading:h,isMetaError:g}=J(n.name,t),{tree:x,isTreeLoading:f,isTreeError:u}=$(n.name,t);if(o||h||f)return(0,r.jsx)(c.Z,{height:"920px"});if(i||g||u)return(0,r.jsx)(d.Z,{height:"920px"});let p="Bin Integer"===n.cn_type?2:0;return(0,r.jsx)(tu,{matrix:l,meta:s,tree:x,baselineCNA:p,reference:n.reference,vizRef:a})};var ty=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"Bin-Level CNA Heatmap"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(tj,{selectedWorkflow:t,dataset:n,vizRef:a})})]})};let tv=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.OG)(e,t),i._);return{genes:n,isGenesLoading:a,isGenesError:r,mutate:s}},tC=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.u4)(e,t),i._);return{newick:n,isNewickLoading:a,isNewickError:r,mutate:s}};var tw=n(1499),tb=n(3870),tS=n(8265);let t_=e=>{let{title:t,config:n,configKey:a,configSubKey:l,options:o,handleConfigChange:i}=e;return(0,r.jsxs)(x.Z,{spacing:1,children:[(0,r.jsx)(f.Z,{sx:{fontWeight:500},children:t}),(0,r.jsx)(tS.ZP.Group,{block:!0,options:o,value:n[a][l],onChange:e=>{i(a,l,e.target.value)},optionType:"button",buttonStyle:"solid",style:{width:"240px"}})]})},tZ=e=>{let{title:t,value:n,color:a}=e;return(0,r.jsx)(u.Z,{title:t,placement:"top",children:(0,r.jsx)(m.Z,{value:n,color:a})})},tk=e=>{let{entity:t,selectedGenes:n,sortedGenes:a,showModal:l}=e;return(0,r.jsxs)(x.Z,{spacing:1,children:[(0,r.jsxs)(f.Z,{sx:{fontWeight:500},children:["Selected ","".concat(t,"s"),":"]}),(0,r.jsxs)(x.Z,{direction:"row",sx:{flexWrap:"wrap",width:"100%",rowGap:"6px"},children:[0===n.length?(0,r.jsx)(m.Z,{value:"No Selected ".concat(t,"s"),color:"red"}):a.slice(0,9).map((e,t)=>(0,r.jsx)(m.Z,{value:e.gene,color:"volcano"},t)),n.length>9?(0,r.jsx)(tZ,{title:"Click to see all selected ".concat(t,"s."),value:"+".concat(n.length-9," ").concat(t,"s"),color:"volcano"}):(0,r.jsx)(r.Fragment,{})]})]})},tA=e=>{let{showModal:t,resetSelectedGenes:n,renderHeatMap:a}=e;return(0,r.jsxs)(x.Z,{spacing:1,sx:{mt:3,mb:2},children:[(0,r.jsxs)(x.Z,{direction:"row",sx:{justifyContent:"space-between"},children:[(0,r.jsx)(tp.ZP,{style:{width:"110px",backgroundColor:"#41B3A2",color:"#FFFFFF",borderColor:"#41B3A2"},onClick:t,children:"Select"}),(0,r.jsx)(tp.ZP,{style:{width:"110px",color:"#41B3A2",borderColor:"#41B3A2"},onClick:n,children:"Reset"})]}),(0,r.jsx)(tp.ZP,{style:{backgroundColor:"#41B3A2",color:"#FFFFFF",borderColor:"#41B3A2"},onClick:a,children:"Render"})]})};var tN=e=>{let{entity:t,selectedGenes:n,sortedGenes:a,showModal:l,resetSelectedGenes:o,renderHeatMap:i}=e;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(tk,{entity:t,selectedGenes:n,sortedGenes:a,showModal:l}),(0,r.jsx)(tA,{showModal:l,resetSelectedGenes:o,renderHeatMap:i})]})};let tL=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(t_,{title:"Mode:",config:t,configKey:n,configSubKey:"mode",options:[{label:"Fixed",value:"Fixed"},{label:"Adaptive",value:"Adaptive"}],handleConfigChange:a}),(0,r.jsx)(en,{title:"CNA Rect Width:",config:t,configKey:n,configSubKey:"CNARectWidth",handleConfigChange:a}),(0,r.jsx)(en,{title:"Meta Rect Width:",config:t,configKey:n,configSubKey:"metaRectWidth",handleConfigChange:a}),"Fixed"===t.heatmap.mode?(0,r.jsx)(en,{title:"Rect Height:",config:t,configKey:n,configSubKey:"rectHeight",handleConfigChange:a}):(0,r.jsx)(en,{title:"Height:",config:t,configKey:n,configSubKey:"height",handleConfigChange:a})]})},tT=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Width:",config:t,configKey:n,configSubKey:"width",handleConfigChange:a}),(0,r.jsx)(en,{title:"Node Radius:",config:t,configKey:n,configSubKey:"nodeRadius",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin To Heatmap:",config:t,configKey:n,configSubKey:"marginToHeatmap",handleConfigChange:a})]})},tP=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Width:",config:t,configKey:n,configSubKey:"width",handleConfigChange:a}),(0,r.jsx)(en,{title:"Height:",config:t,configKey:n,configSubKey:"height",handleConfigChange:a})]})},tM=(e,t,n,a,l,o,i,s)=>[{key:"data",label:"".concat(e," Setting"),extra:(0,r.jsx)(tb.Z,{}),children:(0,r.jsx)(tN,{entity:e,selectedGenes:a,sortedGenes:l,resetSelectedGenes:s,showModal:o,renderHeatMap:i})},{key:"heatmap",label:"Heatmap Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(tL,{config:t,configKey:"heatmap",handleConfigChange:n})},{key:"tree",label:"Tree Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(tT,{config:t,configKey:"tree",handleConfigChange:n})},{key:"nodeHistory",label:"Node History Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(tP,{config:t,configKey:"nodeHistory",handleConfigChange:n})}];var tR=e=>{let{entity:t,config:n,handleConfigChange:a,selectedGenes:l,sortedGenes:o,showModal:i,renderHeatMap:s,resetSelectedGenes:c}=e,[d,h]=(0,F.useState)(["data","heatmap","tree"]),g=(0,F.useMemo)(()=>tM(t,n,a,l,o,i,s,c),[t,n,a,l,o,i,s,c]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:g,activeKey:d,onChange:e=>{h(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})},tz=n(3224);let tI=()=>(0,r.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",transform:"rotate(45)",children:(0,r.jsx)("path",{d:"M661.504 616.6016H381.44a35.328 35.328 0 1 1 0-70.656h314.5728c2.3552-11.3152 3.5328-23.04 3.5328-35.328 0-69.376-39.0656-123.136-117.6064-172.1344a35.328 35.328 0 0 1 37.4272-59.9552c97.1776 60.672 150.8352 134.4 150.8352 232.0384 0 115.2-65.8432 189.952-198.5536 259.072 24.2688 10.2912 47.3088 20.0192 56.4224 24.064 96.768 43.4176 142.1312 80.1792 142.1312 140.9536a35.328 35.328 0 1 1-70.656 0c0-20.992-28.928-44.3904-100.352-76.3904-16.128-7.168-81.408-34.5088-113.4592-48.2816-30.72 13.1072-87.1936 36.9664-102.912 44.032-75.9808 34.0992-107.3664 59.0336-107.3664 80.64a35.328 35.328 0 1 1-70.656 0c0-61.8496 47.2576-99.4816 149.1456-145.1008 20.1216-9.0624 100.864-43.008 119.296-51.2 90.624-40.0384 152.3712-78.08 188.2112-121.7536z m-382.5152-141.312c-2.3552 11.264-3.5328 23.04-3.5328 35.328 0 69.3248 39.0656 123.0336 117.6064 172.032a35.328 35.328 0 1 1-37.4272 60.0064C258.4576 681.984 204.8 608.2048 204.8 510.5664c0-114.6368 65.1776-189.184 196.7104-258.048a3839.0272 3839.0272 0 0 1-50.9952-22.0672C251.2896 185.5488 204.8 147.968 204.8 86.528a35.328 35.328 0 1 1 70.656 0c0 21.504 30.3104 46.08 104.1408 79.4624 16.4352 7.424 76.3392 32.768 107.4176 46.1312 30.0544-12.9024 89.088-37.7856 105.1136-45.056C668.16 133.12 699.5456 108.1344 699.5456 86.528a35.328 35.328 0 1 1 70.656 0c0 61.8496-47.3088 99.4304-149.1456 145.1008-18.7392 8.448-90.0608 38.5024-114.688 49.152a35.5328 35.5328 0 0 1-9.5744 4.2496c-88.0128 39.2704-148.1216 76.6976-183.296 119.552h280.0128a35.328 35.328 0 0 1 0 70.656H278.9888z"})});var tE=e=>(0,r.jsx)(tz.Z,{component:tI,...e}),tH=n(9137),tF=n(1193),tY=n.n(tF);let tB=e=>{let{disabled:t,setDisabled:n,titleContent:a}=e;return(0,r.jsx)("div",{style:{width:"100%",cursor:"move"},onMouseOver:()=>{t&&n(!1)},onMouseOut:()=>{n(!0)},onFocus:()=>{},onBlur:()=>{},children:a})};var tW=e=>{let{titleContent:t,children:n,...a}=e,[l,o]=(0,F.useState)(!0),[i,s]=(0,F.useState)({left:0,top:0,bottom:0,right:0}),c=(0,F.useRef)(null),d=(e,t)=>{var n;let{clientWidth:r,clientHeight:a}=window.document.documentElement,l=null===(n=c.current)||void 0===n?void 0:n.getBoundingClientRect();l&&s({left:-l.left+t.x,right:r-(l.right-t.x),top:-l.top+t.y,bottom:a-(l.bottom-t.y)})};return(0,r.jsx)(tH.Z,{title:(0,r.jsx)(tB,{disabled:l,setDisabled:o,titleContent:t}),modalRender:e=>(0,r.jsx)(tY(),{disabled:l,bounds:i,nodeRef:c,onStart:(e,t)=>d(e,t),children:(0,r.jsx)("div",{ref:c,children:e})}),zIndex:1200,...a,children:n})},tK=n(1816),tO=n(9980),tD=n(3165),tU=n(2516),tV=n(3484),tG=n(7874);let tX=()=>(0,r.jsx)("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"currentColor",children:(0,r.jsx)("path",{d:"M878.08 731.274667a32 32 0 0 1-54.88-32.938667A360.789333 360.789333 0 0 0 874.666667 512c0-200.298667-162.368-362.666667-362.666667-362.666667S149.333333 311.701333 149.333333 512s162.368 362.666667 362.666667 362.666667a360.789333 360.789333 0 0 0 186.314667-51.445334 32 32 0 0 1 32.928 54.88A424.778667 424.778667 0 0 1 512 938.666667C276.362667 938.666667 85.333333 747.637333 85.333333 512S276.362667 85.333333 512 85.333333s426.666667 191.029333 426.666667 426.666667c0 78.293333-21.152 153.568-60.586667 219.274667zM650.666667 437.333333c0 65.898667-46.72 120.853333-109.194667 135.082667V608a32 32 0 0 1-64 0v-64a32 32 0 0 1 32-32C552.266667 512 586.666667 478.4 586.666667 437.333333s-34.4-74.666667-77.194667-74.666666c-26.773333 0-51.082667 13.248-65.173333 34.624a73.088 73.088 0 0 0-8.522667 17.717333 32 32 0 0 1-60.885333-19.690667c3.797333-11.754667 9.173333-22.933333 15.978666-33.237333 25.856-39.253333 70.186667-63.413333 118.613334-63.413333C587.274667 298.666667 650.666667 360.576 650.666667 437.333333zM512 736a32 32 0 1 1 0-64 32 32 0 0 1 0 64z"})});var tq=e=>(0,r.jsx)(tz.Z,{component:tX,...e});let tJ=e=>{let{handleDelete:t,handleDeleteCancel:n}=e;return(0,r.jsxs)(tU.Z,{vertical:!0,gap:4,children:[(0,r.jsx)(tU.Z,{justify:"center",children:(0,r.jsx)(tq,{style:{fontSize:"24px",color:"#faad14"}})}),(0,r.jsx)(tU.Z,{justify:"center",children:(0,r.jsx)(f.Z,{sx:{fontSize:"14px"},children:"Sure to Delete?"})}),(0,r.jsx)(f.Z,{component:"hr",sx:{margin:"0px 0px 4px 0px"}}),(0,r.jsxs)(tU.Z,{gap:8,justify:"center",children:[(0,r.jsx)(tp.ZP,{danger:!0,size:"small",onClick:t,children:"Confirm"}),(0,r.jsx)(tp.ZP,{size:"small",color:"primary",variant:"outlined",onClick:n,children:"Cancel"})]})]})};var t$=e=>{let{handleDelete:t}=e,[n,a]=(0,F.useState)(!1);return(0,r.jsx)(tG.Z,{placement:"top",content:(0,r.jsx)(tJ,{handleDelete:t,handleDeleteCancel:()=>{a(!1)}}),trigger:["click"],open:n,onOpenChange:e=>{a(e)},styles:{body:{padding:"4px 8px 10px 8px"}},children:(0,r.jsx)(tp.ZP,{danger:!0,type:"dashed",children:"Delete"})})},tQ=n(9386),t0=n(8236);let t1=e=>{let{handleSearchTextChange:t}=e,[n,a]=(0,F.useState)("");return(0,r.jsx)(t0.Z.Search,{placeholder:"Search...",allowClear:!0,value:n,onChange:e=>a(e.target.value),onSearch:()=>{null==t||t(n)},onClear:()=>{null==t||t("")},style:{width:200}})},t2=(0,n(7834).Z)(tD.Z)({"& .ant-table":{"& .ant-table-container":{minHeight:385,"& .ant-table-body, & .ant-table-content":{scrollbarWidth:"thin",scrollbarColor:"#eaeaea transparent",scrollbarGutter:"stable","& .ant-empty":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:233}},"& .ant-table-header > table":{width:"max-content",minWidth:"100%","& .ant-table-cell-fix-right-first":{minWidth:"125px"}}}},"& .ant-spin-nested-loading":{"& .ant-spin":{maxHeight:1e3}}}),t6={threshold:.3,keys:["gene"]},t3=e=>{let{entity:t,selectedGenes:n,setSelectedGenes:a}=e,[l,o]=(0,F.useState)(""),[i,s]=(0,F.useState)([]),c=(0,tO.z)(),d=(0,F.useMemo)(()=>l?new tQ.Z(n,t6).search(l).map(e=>e.item):n,[n,l]),h=e=>{a(n.filter(t=>t.id!==e.id))},g={selectedRowKeys:i,columnWidth:"56px",onChange:e=>{s([...new Set([...e])])},selections:[tD.Z.SELECTION_ALL,tD.Z.SELECTION_INVERT,tD.Z.SELECTION_NONE]},x=[{title:"".concat(t," Name"),dataIndex:"gene",key:"gene_name",align:"center",sorter:(e,t)=>e.gene.localeCompare(t.gene)},{title:"Action",key:"action",align:"center",render:(e,t)=>(0,r.jsx)(t$,{handleDelete:()=>h(t)})}];return(0,r.jsxs)(f.Z,{sx:{width:"96%",margin:"auto",minHeight:"500px"},children:[(0,r.jsxs)(tU.Z,{justify:"space-between",style:{margin:"8px 0px 16px 0px"},children:[(0,r.jsx)(tp.ZP,{icon:(0,r.jsx)(tV.Z,{count:i.length,showZero:!0}),onClick:()=>{0!==i.length&&(a(n.filter(e=>!i.includes(e.id))),c.open({type:"success",content:"Successfully Delete ".concat(i.length," Selected ").concat(t,"s!")}),s([]))},iconPosition:"end",children:"Delete Selected"}),(0,r.jsx)(t1,{handleSearchTextChange:e=>{o(e)}})]}),(0,r.jsx)(t2,{columns:x,dataSource:d,rowKey:"id",rowSelection:g,pagination:{defaultPageSize:5,showQuickJumper:!0,pageSizeOptions:[5,10,30,50,100],showSizeChanger:!0,showTotal:(e,n)=>"".concat(n[0],"-").concat(n[1]," of ").concat(e," ").concat(t,"s")},scroll:{y:330}})]})},t4=e=>{let{entity:t,genes:n,selectedGenes:a,setSelectedGenes:l}=e,[o,i]=(0,F.useState)(""),[s,c]=(0,F.useState)({rowKeys:[],rows:[]}),d=(0,tO.z)(),h=(0,F.useMemo)(()=>o?new tQ.Z(n,t6).search(o).map(e=>e.item):n,[n,o]),g=[{title:"".concat(t," Name"),dataIndex:"gene",key:"gene_name",align:"center",sorter:(e,t)=>e.gene.localeCompare(t.gene)},{title:"Action",key:"action",align:"center",render:(e,t)=>a.find(e=>e.id===t.id)?(0,r.jsx)(t$,{handleDelete:()=>u(t)}):(0,r.jsx)(tp.ZP,{type:"dashed",onClick:()=>p(t),children:"Add"})}],x={selectedRowKeys:s.rowKeys,columnWidth:"56px",onChange:(e,t)=>{c({rowKeys:e,rows:t})},preserveSelectedRowKeys:!0,selections:[tD.Z.SELECTION_ALL,tD.Z.SELECTION_INVERT,tD.Z.SELECTION_NONE],getCheckboxProps:e=>({disabled:!!a.find(t=>t.id===e.id)})},u=e=>{l(a.filter(t=>t.id!==e.id)),c({rowKeys:a.filter(t=>t.id!==e.id).map(e=>e.id),rows:a.filter(t=>t.id!==e.id)})},p=e=>{l([...a,e]),c({rowKeys:[...s.rowKeys,e.id],rows:[...s.rows,e]})};return(0,r.jsxs)(f.Z,{sx:{width:"96%",margin:"auto",minHeight:"500px"},children:[(0,r.jsxs)(tU.Z,{justify:"space-between",style:{margin:"8px 0px 16px 0px"},children:[(0,r.jsx)(tp.ZP,{icon:(0,r.jsx)(tV.Z,{count:s.rowKeys.length-a.length,showZero:!0}),iconPosition:"end",onClick:()=>{s.rowKeys.length>100?d.open({type:"warning",content:"Selecting more than 100 ".concat(t,"s is not allowed.")}):s.rowKeys.length-a.length!=0?(l([...s.rows]),d.open({type:"success",content:"Successfully Add ".concat(s.rowKeys.length-a.length," Selected ").concat(t,"s!")})):d.open({type:"warning",content:"At least one ".concat(t," must be selected before adding.")})},children:"Add Selected"}),(0,r.jsx)(t1,{handleSearchTextChange:e=>{i(e)}})]}),(0,r.jsx)(t2,{columns:g,rowSelection:x,rowKey:e=>e.id,dataSource:h,pagination:{defaultPageSize:5,showQuickJumper:!0,pageSizeOptions:[5,10,30,50,100],showSizeChanger:!0,showTotal:(e,n)=>"".concat(n[0],"-").concat(n[1]," of ").concat(e," ").concat(t,"s")},scroll:{y:330}})]})};var t8=e=>{let{entity:t,genes:n,isModalOpen:a,handleModalCancel:l,selectedGenes:o,setSelectedGenes:i}=e,s=(0,r.jsxs)(f.Z,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,r.jsx)(tE,{style:{fontSize:"36px",marginRight:"6px"}}),(0,r.jsxs)(f.Z,{sx:{fontWeight:"500",fontSize:"28px",pointerEvents:"none"},children:["Selected ","".concat(t,"s")]}),(0,r.jsxs)(f.Z,{sx:{fontWeight:"normal",fontSize:"14px",color:"#888",position:"relative",top:"4px",pointerEvents:"none"},children:["(Maximum of 100 ","".concat(t,"s"),")"]})]});return(0,r.jsx)(tW,{titleContent:s,open:a,onCancel:l,footer:[],width:1450,centered:!0,children:(0,r.jsx)(tK.Z,{tabBarStyle:{marginLeft:"16px"},items:[{label:"Selected ".concat(t,"s"),key:"selected-genes",children:(0,r.jsx)(t3,{entity:t,selectedGenes:o,setSelectedGenes:i})},{label:"Select ".concat(t,"s"),key:2,children:(0,r.jsx)(t4,{entity:t,genes:n,selectedGenes:o,setSelectedGenes:i})}]})})},t5=()=>{let[e,t]=(0,F.useState)(["n0"]),[n,r]=(0,F.useState)(0);return{nodeHistoryList:e,currentNodeIndex:n,goBackNode:()=>{n>0&&r(n-1)},goForwardNode:()=>{n<e.length-1&&r(n+1)},goBackRoot:()=>{t(["n0"]),r(0)},goToTreeNode:a=>{t([...e.slice(0,n+1),a]),r(n+1)}}};let t9=(e,t,n)=>{let r=eN.ueB(e,eN.rA8),a={...ne(t7(t,r))};return{processedMeta:nr(r,n),colorScales:a}},t7=(e,t)=>{let n={};return e.forEach(e=>{let r=t.map(t=>t[e]);n[e]={min:Math.min(...r),max:Math.max(...r)}}),n},ne=e=>{let t=eN.BYU().domain([e.e_PCA1.min,e.e_PCA1.max]).range(["#c4a1d3","#ad49e1"]),n=eN.BYU().domain([e.e_PCA2.min,e.e_PCA2.max]).range(["#52b199","#0d7c66"]),r=eN.BYU().domain([e.e_TSNE1.min,e.e_TSNE2.max]).range(["#d88f92","#c63c51"]);return{e_PCA1:t,e_PCA2:n,e_TSNE1:r,e_TSNE2:eN.BYU().domain([e.e_TSNE2.min,e.e_TSNE2.max]).range(["#bad9ff","#3572ef"]),e_UMAP1:eN.BYU().domain([e.e_UMAP1.min,e.e_UMAP1.max]).range(["#ffa699","#ff7f3e"]),e_UMAP2:eN.BYU().domain([e.e_UMAP2.min,e.e_UMAP2.max]).range(["#f0e8fa","#FF76CE"])}},nt=(e,t,n)=>{let r=eN.ueB(e,eN.rA8),a=nn(n);return{processedMatrix:nr(r,t.map(e=>e.gene)),CNVColorScale:a}},nn=e=>{let t=eN.BYU().domain(2===e?[0,2]:[-1,0]).range(["#add8e6","#ffffff"]).clamp(!0),n=eN.BYU().domain(2===e?[2,10]:[0,1]).range(["#ffffff","#6A0220"]).clamp(!0);return e=>e<2?t(e):n(e)},nr=(e,t)=>e.reduce((e,n)=>(e[n.id]=t.map(e=>n[e]),e),{});var na=e=>{let{legendWidth:t,legendHeight:n,colorScales:a,baselineCNA:l}=e,o=2===l?[0,2,10]:[-1,0,1],i=eN.PUr(o,["#add8e6","#ffffff","#6A0220"]);return(0,r.jsxs)("g",{children:[(0,r.jsx)(eV,{color:i,title:"CNV Value",width:t,legendMarginTop:0,ticks:o[2]-o[0]+1}),(0,r.jsx)(eV,{color:a.e_PCA1,title:"ePCA1",width:t,legendMarginTop:n}),(0,r.jsx)(eV,{color:a.e_PCA2,title:"ePCA2",width:t,legendMarginTop:2*n}),(0,r.jsx)(eV,{color:a.e_TSNE1,title:"e_TSNE1",width:t,legendMarginTop:3*n}),(0,r.jsx)(eV,{color:a.e_TSNE2,title:"e_TSNE2",width:t,legendMarginTop:4*n}),(0,r.jsx)(eV,{color:a.e_UMAP1,title:"e_UMAP1",width:t,legendMarginTop:5*n}),(0,r.jsx)(eV,{color:a.e_UMAP2,title:"e_UMAP2",width:t,legendMarginTop:6*n})]})},nl=e=>{let{buttonWidth:t,buttonHeight:n,currentNodeIndex:a,nodeHistoryList:l,goBackRoot:o,goForwardNode:i,goBackNode:s}=e;return(0,r.jsxs)("g",{children:[(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{width:2*t+4,height:n,fill:0===a?"#AAE3D8":"#41B3A2",rx:5,ry:5,cursor:0===a?"not-allowed":"pointer",onClick:0===a?null:o}),(0,r.jsx)("text",{fontSize:10,x:t+2,y:n/2,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",pointerEvents:"none",children:"Back To Root"})]}),(0,r.jsxs)("g",{transform:"translate(0, ".concat(n+4,")"),children:[(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{width:t,height:n,fill:0===a?"#AAE3D8":"#41B3A2",rx:5,ry:5,cursor:0===a?"not-allowed":"pointer",onClick:0===a?null:s}),(0,r.jsx)("text",{fontSize:10,x:t/2,y:n/2,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",pointerEvents:"none",children:"Prev"})]}),(0,r.jsxs)("g",{transform:"translate(".concat(t+4,", 0)"),children:[(0,r.jsx)("rect",{width:t,height:n,fill:a===l.length-1?"#AAE3D8":"#41B3A2",rx:5,ry:5,cursor:a===l.length-1?"not-allowed":"pointer",onClick:a===l.length-1?null:i}),(0,r.jsx)("text",{fontSize:10,x:t/2,y:n/2,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",pointerEvents:"none",children:"Next"})]})]})]})};let no=(e,t,n,r)=>{let a=eN.Ys(e.current),l=[[[t.verticalPosition,t.horizontalPosition],[n+r,t.topX]],[[t.verticalPosition,t.horizontalPosition],[n+r,t.bottomX]]],o=eN.jvg().x(e=>e[0]).y(e=>e[1]).curve(eN.qpX);a.selectAll("path").data(l).join("path").attr("fill","none").attr("stroke","black").attr("d",e=>o(e))},ni=e=>{eN.Ys(e.current).selectAll("path").remove()};var ns=e=>{let{root:t,nodes:n,leaves:a,goToTreeNode:l,settings:o,showTooltip:i,hideTooltip:s}=e,c=(0,F.useRef)(null),d=(0,F.useRef)(null),h=(0,F.useRef)(null),g=(0,F.useRef)(null),x=t.links().filter(e=>n.includes(e.source)&&n.includes(e.target));return(0,F.useEffect)(()=>{eN.Ys(d.current).selectAll("path").data(x).join("path").attr("d",tt)},[x]),(0,F.useEffect)(()=>{let e=eN.Ys(h.current);ni(g),e.selectAll("circle").data(n,e=>e.data.name).join("circle").attr("transform",tn).attr("r",o.nodeRadius).attr("fill",e=>e.children?"#333":"#999").on("click",(e,t)=>{t.children&&l(t.data.name)}).on("mouseover",(e,t)=>{a.includes(t)&&no(g,t,o.width,o.marginToHeatmap),i(e,tl(t.data.name,t.parent?t.parent.data.name:"NONE",t.value,t.data.distanceToRoot))}).on("mousemove",(e,t)=>{i(e,tl(t.data.name,t.parent?t.parent.data.name:"NONE",t.value,t.data.distanceToRoot))}).on("mouseout",s)},[n,l,o.nodeRadius,s,i,o.width,a]),(0,r.jsxs)("g",{ref:c,children:[(0,r.jsx)("g",{ref:d,className:"links",fill:"none",stroke:"#000000"}),(0,r.jsx)("g",{ref:h,className:"nodes",cursor:"pointer",pointerEvents:"all"}),(0,r.jsx)("g",{ref:g,className:"curves"})]})},nc=e=>{let{filteredMeta:t,xMeta:n,yMeta:a,metaFields:l,colorScales:o,showTooltip:i,hideTooltip:s}=e,c=(0,F.useRef)(null),d=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=eN.Ys(c.current);e.call(eN.F5q(n).tickSize(0)).call(e=>e.select(".domain").remove()),e.selectAll(".tick text").attr("transform","rotate(-90)").attr("x",6).attr("y",.1*n.bandwidth()).style("text-anchor","start")},[n]),(0,F.useEffect)(()=>{eN.Ys(d.current).selectAll("g").data(Object.entries(t)).join("g").attr("transform",e=>"translate(0, ".concat(a(e[0]),")")).selectAll("rect").data(e=>e[1].map((t,n)=>({value:t,key:e[0],index:n}))).join("rect").attr("x",(e,t)=>n(l[t])).attr("width",n.bandwidth()-.05).attr("height",a.bandwidth()-.05).attr("fill",(e,t)=>o[l[t]](e.value)).on("mouseenter",(e,t)=>{i(e,tr(t.key,o[l[t.index]](t.value),l[t.index],t.value))}).on("mousemove",(e,t)=>{i(e,tr(t.key,o[l[t.index]](t.value),l[t.index],t.value))}).on("mouseout",s)},[o,t,s,l,i,n,a]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("g",{ref:c}),(0,r.jsx)("g",{ref:d})]})},nd=e=>{let{cutTreeCNVMatrix:t,xMatrix:n,yMatrix:a,geneInfos:l,CNVMatrixScale:o,showTooltip:i,hideTooltip:s}=e,c=(0,F.useRef)(null),d=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=eN.Ys(c.current);e.call(eN.F5q(n).tickSize(0).tickFormat((e,t)=>l[t].gene)).call(e=>e.select(".domain").remove()),e.selectAll(".tick text").attr("transform","rotate(-90)").attr("x",6).attr("y",.1*n.bandwidth()).style("cursor","default").style("text-anchor","start")},[l,s,i,n]),(0,F.useEffect)(()=>{eN.Ys(d.current).selectAll("g").data(Object.entries(t)).join("g").attr("transform",e=>"translate(0, ".concat(a[e[0]].y,")")).selectAll("rect").data(e=>e[1].map((t,n)=>({value:t,key:e[0],index:n}))).join("rect").attr("x",(e,t)=>n(l[t].gene)).attr("width",n.bandwidth()-.05).attr("height",e=>a[e.key].height).attr("fill",e=>o(e.value)).on("mouseenter",(e,t)=>{i(e,tr(t.key,o(t.value),l[t.index].gene,t.value))}).on("mousemove",(e,t)=>{i(e,tr(t.key,o(t.value),l[t.index].gene,t.value))}).on("mouseout",s)},[o,t,l,s,i,n,a]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("g",{ref:c}),(0,r.jsx)("g",{ref:d})]})};let nh=["e_PCA1","e_PCA2","e_TSNE1","e_TSNE2","e_UMAP1","e_UMAP2"],ng=(0,F.forwardRef)((e,t)=>{let{meta:n,newick:a,renderGenes:l,geneMatrix:o,baselineCNA:i,entity:s="Gene",cluster:c=64,config:d,isShowLeft:h,handleIsShowLeftChange:g}=e,{nodeHistoryList:x,currentNodeIndex:u,goBackNode:p,goForwardNode:m,goBackRoot:j,goToTreeNode:y}=t5(),v=(0,F.useRef)(null),C=(0,F.useRef)(null),w=(0,F.useRef)(null),b=(0,F.useMemo)(()=>e$(a),[a]),{processedMeta:S,colorScales:_}=(0,F.useMemo)(()=>t9(n,["e_PCA1","e_PCA2","e_TSNE1","e_TSNE2","e_UMAP1","e_UMAP2"],nh),[n]),{processedMatrix:Z,CNVColorScale:k}=(0,F.useMemo)(()=>nt(o,l,i),[i,o,l]),A=b.find(e=>e.data.name===x[u]),{nodes:N,leaves:L,yMeta:T,xMeta:P,filteredMeta:M,xMatrix:R,yMatrix:z,cutTreeCNVMatrix:I}=e0(A,c,S,nh,l,Z,d.tree,d.heatmap),E=(e,t)=>{w.current.showTooltip(e,t)},H=()=>{w.current.hideTooltip()};return(0,F.useEffect)(()=>{let e=eN.sPX().scaleExtent([.1,10]).on("zoom",function(e){eN.Ys(C.current).attr("transform",e.transform)});eN.Ys(v.current).call(e)},[]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{v.current&&tx(v.current,"".concat(s,"-Level_CNA_Heatmap.svg"))}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:h,handleIsShowLeftChange:g,title:"Setting Options"})}),(0,r.jsx)("svg",{ref:v,width:"100%",height:"100%",children:(0,r.jsxs)("g",{ref:C,transform:"translate(100, 100)",children:[(0,r.jsx)("g",{className:"ColorLegends",children:(0,r.jsx)(na,{legendWidth:d.legend.width,legendHeight:d.legend.height,colorScales:_,baselineCNA:i})}),(0,r.jsxs)("g",{className:"TreeChartContainer",transform:"translate(".concat(d.legend.width+50,")"),children:[(0,r.jsx)("g",{className:"NodeHistory",transform:"translate(200, -50)",children:(0,r.jsx)(nl,{buttonWidth:d.nodeHistory.width,buttonHeight:d.nodeHistory.height,currentNodeIndex:u,nodeHistoryList:x,goBackRoot:j,goForwardNode:m,goBackNode:p})}),(0,r.jsx)("g",{className:"TreeChart",children:(0,r.jsx)(ns,{root:A,nodes:N,leaves:L,goToTreeNode:y,settings:d.tree,showTooltip:E,hideTooltip:H})})]}),(0,r.jsxs)("g",{transform:"translate(".concat(d.legend.width+50+d.tree.width+d.tree.marginToHeatmap,", 0)"),children:[(0,r.jsx)(nc,{filteredMeta:M,xMeta:P,yMeta:T,metaFields:nh,colorScales:_,showTooltip:E,hideTooltip:H}),(0,r.jsx)(nd,{cutTreeCNVMatrix:I,xMatrix:R,yMatrix:z,geneInfos:l,CNVMatrixScale:k,showTooltip:E,hideTooltip:H})]})]})}),(0,eX.createPortal)((0,r.jsx)(eq,{ref:w}),document.body)]})});ng.displayName="CNAGeneHeatmapPanel";let nx=e=>{let{entity:t,meta:n,newick:a,renderGenes:l,geneMatrix:o,baselineCNA:i,config:s,processing:d,isShowLeft:h,handleIsShowLeftChange:g,vizRef:x}=e;return(0,r.jsx)(r.Fragment,{children:d?(0,r.jsx)(c.Z,{containerSx:{height:"910px"},loadingPrompt:"Processing Data..., please wait for a moment."}):null===o?(0,r.jsx)(f.Z,{sx:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:(0,r.jsxs)(f.Z,{sx:{fontWeight:500,fontSize:"28px"},children:["Please select ","".concat(t,"s")," to render the corresponding visualization."]})}):(0,r.jsx)(ng,{meta:n,newick:a,renderGenes:l,geneMatrix:o,baselineCNA:i,entity:t,config:s,isShowLeft:h,handleIsShowLeftChange:g,ref:x})})};var nf=e=>{let{meta:t,newick:n,genes:a,geneMatrixFetcher:l,baselineCNA:o,entity:i="Gene",vizRef:s}=e,[c,d]=(0,F.useState)(!0),[h,g]=(0,F.useState)(!1),[x,f]=(0,F.useState)([]),[u,p]=(0,F.useState)([]),[m,j]=(0,F.useState)(null),[y,v]=(0,F.useState)(!1),[C,w]=(0,F.useState)({heatmap:{mode:"Fixed",CNARectWidth:16,metaRectWidth:16,rectHeight:10,height:1e3},tree:{width:300,nodeRadius:4,marginToHeatmap:20},nodeHistory:{width:35,height:20},legend:{width:250,height:50,marginToTree:50}}),b=(0,F.useMemo)(()=>[...x].sort((e,t)=>e.gene.length-t.gene.length),[x]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eh.Z,{isShowLeft:c,leftPanelWidth:300,leftPanel:(0,r.jsx)(tR,{entity:i,config:C,handleConfigChange:(e,t,n)=>{w(r=>({...r,[e]:{...r[e],[t]:n}}))},selectedGenes:x,sortedGenes:b,showModal:()=>{g(!0)},renderHeatMap:()=>{0!==x.length&&(v(!0),l(x.map(e=>e.gene)).then(e=>{""!==e.data?(j(e.data),p([...x])):j([])}).finally(()=>{v(!1)}))},resetSelectedGenes:()=>{f([])}}),rightPanel:(0,r.jsx)(nx,{entity:i,meta:t,newick:n,renderGenes:u,geneMatrix:m,baselineCNA:o,config:C,processing:y,isShowLeft:c,handleIsShowLeftChange:()=>{d(!c)},vizRef:s})}),(0,r.jsx)(t8,{entity:i,genes:a,isModalOpen:h,handleModalCancel:()=>{g(!1)},selectedGenes:x,setSelectedGenes:f})]})};let nu=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{meta:l,isMetaLoading:i,isMetaError:s}=J(n.name,t),{newick:h,isNewickLoading:g,isNewickError:x}=tC(n.name,t),{genes:f,isGenesLoading:u,isGenesError:p}=tv(n.name,t),m="Bin Integer"===n.cn_type?2:0;return i||g||u?(0,r.jsx)(c.Z,{height:"920px"}):s||x||p?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(nf,{entity:"Gene",meta:l,newick:h,genes:f,geneMatrixFetcher:e=>tw.Z.post((0,o.h8)(),{datasetName:n.name,workflowType:t,genes:e}),baselineCNA:m,vizRef:a})};var np=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"Gene-Level CNA Heatmap"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(nu,{dataset:n,selectedWorkflow:t,vizRef:a})})]})};let nm=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.vS)(e,t),i._);return{terms:n,isTermsLoading:a,isTermsError:r,mutate:s}},nj=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{meta:l,isMetaLoading:i,isMetaError:s}=J(n.name,t),{newick:h,isNewickLoading:g,isNewickError:x}=tC(n.name,t),{terms:f,isTermsLoading:u,isTermsError:p}=nm(n.name,t),m="Bin Integer"===n.cn_type?2:0;return i||g||u?(0,r.jsx)(c.Z,{height:"920px"}):s||x||p?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(nf,{entity:"Term",meta:l,newick:h,genes:f,geneMatrixFetcher:e=>tw.Z.post((0,o.l4)(),{datasetName:n.name,workflowType:t,terms:e}),baselineCNA:m,vizRef:a})};var ny=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"Term-Level CNA Heatmap"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(nj,{selectedWorkflow:t,dataset:n,vizRef:a})})]})};let nv=[{value:"e_PCA",label:"PCA"},{value:"e_TSNE",label:"TSNE"},{value:"e_UMAP",label:"UMAP"}],nC=e=>{let{embeddingMethod:t,handleEmbeddingMethodChange:n}=e;return(0,r.jsxs)(x.Z,{spacing:1,children:[(0,r.jsx)(f.Z,{sx:{fontWeight:500},children:"Embedding Method:"}),(0,r.jsx)(B.default,{value:t,onChange:n,options:nv,style:{width:"240px"},size:"large"})]})},nw=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Margin:",config:t,configKey:n,configSubKey:"margin",handleConfigChange:a}),(0,r.jsx)(en,{title:"Axis Width:",config:t,configKey:n,configSubKey:"axisWidth",handleConfigChange:a})]})},nb=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsx)(en,{title:"Radius:",config:t,configKey:n,configSubKey:"radius",handleConfigChange:a})},nS=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Margin Top:",config:t,configKey:n,configSubKey:"marginTop",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Bottom:",config:t,configKey:n,configSubKey:"marginBottom",handleConfigChange:a}),(0,r.jsx)(en,{title:"Font Size:",config:t,configKey:n,configSubKey:"fontSize",handleConfigChange:a})]})},n_=(e,t,n,a)=>[{key:"data",label:"Data Setting",extra:(0,r.jsx)(tb.Z,{}),children:(0,r.jsx)(nC,{embeddingMethod:n,handleEmbeddingMethodChange:a})},{key:"chart",label:"Chart Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(nw,{config:e,configKey:"chart",handleConfigChange:t})},{key:"scatter",label:"Scatter Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(nb,{config:e,configKey:"scatter",handleConfigChange:t})},{key:"title",label:"Title Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(nS,{config:e,configKey:"title",handleConfigChange:t})}];var nZ=e=>{let{embeddingMethod:t,handleEmbeddingMethodChange:n,config:a,handleConfigChange:l}=e,[o,i]=(0,F.useState)(["data","chart","scatter"]),s=(0,F.useMemo)(()=>n_(a,l,t,n),[a,t,l,n]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:s,activeKey:o,onChange:e=>{i(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})};let nk=(e,t)=>{let n=e-16,r=n-2*t.chart.margin,a=t.title.marginTop+t.title.marginBottom+Math.ceil(1.31*t.title.fontSize),l=r-a-t.chart.axisWidth,o=l+t.chart.axisWidth;return{svgWidth:o+2*t.chart.margin,svgHeight:n,innerWidth:o,figureSize:l,xOffsetScatterPlot:t.chart.axisWidth,yOffsetScatterPlot:a,yOffsetXAxis:a+l,xRange:[0,l],yRange:[l,0]}},nA=(e,t)=>{let n=[Math.min(t["".concat(e,"1")].min,t["".concat(e,"2")].min),Math.max(t["".concat(e,"1")].max,t["".concat(e,"2")].max)];return[5*Math.floor(n[0]/5),5*Math.ceil(n[1]/5)]},nN=(e,t,n)=>({x:eN.BYU().domain(e).range(t),y:eN.BYU().domain(e).range(n)}),nL=(e,t,n)=>(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)("div",{style:{fontSize:18,textAlign:"center",color:"#666",fontWeight:800,lineHeight:"1.5"},children:e}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{display:"inline-block",marginRight:4,borderRadius:10,width:10,height:10,backgroundColor:n}}),(0,r.jsxs)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:[eP().round(t[0],5),", ",eP().round(t[1],5)]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),nT=(0,F.forwardRef)((e,t)=>{let{embeddingMethod:n,meta:a,extents:l,config:o,isShowLeft:i,handleIsShowLeftChange:s}=e,c=(0,F.useRef)(null),d=(0,F.useRef)(null),h=(0,F.useRef)(null),g=(0,F.useRef)(null),u=(0,F.useRef)(null),{svgWidth:p,svgHeight:m,innerWidth:j,figureSize:y,xOffsetScatterPlot:v,yOffsetScatterPlot:C,yOffsetXAxis:w,xRange:b,yRange:S}=nk(920,o),{x:_,y:Z}=nN(nA(n,l),b,S);return(0,F.useEffect)(()=>{eN.Ys(h.current).call(eN.LLu(_))},[_]),(0,F.useEffect)(()=>{eN.Ys(g.current).call(eN.y4O(Z))},[Z]),(0,F.useEffect)(()=>{eN.Ys(u.current).selectAll("circle").data(a,e=>e.id).join("circle").attr("cx",e=>_(e["".concat(n,"1")])).attr("cy",e=>Z(e["".concat(n,"2")])).attr("r",o.scatter.radius).attr("fill","rgba(30, 144, 255, 0.6)").on("pointerenter pointermove",(e,t)=>nP(e,t.id,[t["".concat(n,"1")],t["".concat(n,"2")]],"rgba(30, 144, 255, 0.6)",d)).on("pointerleave",()=>nM(d))},[o.scatter.radius,n,a,_,Z]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{c.current&&tx(c.current,"".concat(n.slice(2),"_Embedding_Map.svg"))}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:i,handleIsShowLeftChange:s,title:"Setting Options"})}),(0,r.jsx)(x.Z,{sx:{alignItems:"center",overflowX:"auto"},children:(0,r.jsx)("svg",{ref:c,width:p,height:m,children:(0,r.jsxs)("g",{className:"plotContainer",transform:"translate(".concat(o.chart.margin,", ").concat(o.chart.margin,")"),children:[(0,r.jsx)("g",{className:"title",children:(0,r.jsxs)("text",{fontSize:o.title.fontSize,transform:"translate(".concat(p/2,", ").concat(o.title.marginTop,")"),dy:"1em",textAnchor:"middle",fontWeight:500,children:[n.slice(2)," Embedding Map"]})}),(0,r.jsx)("g",{ref:h,transform:"translate(".concat(v,", ").concat(w,")"),children:(0,r.jsxs)("text",{x:y/2,y:36,fontSize:14,fontWeight:"bold",fill:"black",textAnchor:"middle",children:[n.slice(2),"1"]})}),(0,r.jsx)("g",{ref:g,transform:"translate(".concat(v,", ").concat(C,")"),children:(0,r.jsxs)("text",{y:y/2+36,fontSize:14,fontWeight:"bold",fill:"black",textAnchor:"middle",transform:"rotate(90, 0, ".concat(y/2,")"),children:[n.slice(2),"2"]})}),(0,r.jsx)("g",{ref:u,transform:"translate(".concat(v,", ").concat(C,")")})]})})}),(0,eX.createPortal)((0,r.jsx)(eq,{ref:d}),document.body)]})}),nP=(e,t,n,r,a)=>{a.current.showTooltip(e,nL(t,n,r))},nM=e=>{e.current.hideTooltip()};nT.displayName="EmbeddingMapPanel";let nR=["id","e_PCA1","e_PCA2","e_TSNE1","e_TSNE2","e_UMAP1","e_UMAP2"],nz=e=>{let t=eN.ueB(e,eN.rA8),n=t.map(e=>Object.fromEntries(Object.entries(e).filter(e=>{let[t]=e;return nR.includes(t)}))),r=nR.filter(e=>"id"!==e),a=Object.fromEntries(r.map(e=>[e,{min:1/0,max:-1/0}]));for(let e of t)for(let t of r){let n=e[t];Number.isFinite(n)&&(n<a[t].min&&(a[t].min=n),n>a[t].max&&(a[t].max=n))}for(let e of r)a[e].min===1/0&&(a[e]={min:null,max:null});return{processedMeta:n,extents:a}};var nI=e=>{let{meta:t,vizRef:n}=e,[a,l]=(0,F.useState)("e_PCA"),[o,i]=(0,F.useState)(!0),[s,c]=(0,F.useState)({chart:{margin:30,axisWidth:50},scatter:{radius:4},title:{marginTop:20,marginBottom:20,fontSize:24},legend:{width:120,height:20,itemVerticalGap:5,itemHorizontalGap:5,marginLeft:30}}),{processedMeta:d,extents:h}=(0,F.useMemo)(()=>nz(t),[t]);return(0,r.jsx)(eh.Z,{isShowLeft:o,leftPanelWidth:300,leftPanel:(0,r.jsx)(nZ,{embeddingMethod:a,handleEmbeddingMethodChange:e=>{l(e)},config:s,handleConfigChange:(e,t,n)=>{c(r=>({...r,[e]:{...r[e],[t]:n}}))}}),rightPanel:(0,r.jsx)(nT,{embeddingMethod:a,meta:d,extents:h,config:s,isShowLeft:o,handleIsShowLeftChange:()=>{i(!o)},ref:n})})};let nE=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{meta:l,isMetaLoading:o,isMetaError:i}=J(n.name,t);return o?(0,r.jsx)(c.Z,{height:"920px"}):i?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(nI,{meta:l,vizRef:a})};var nH=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"CNA Embedding Map"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(nE,{dataset:n,selectedWorkflow:t,vizRef:a})})]})};let nF=e=>{let{hcluster:t,handleHclusterChange:n,clusterList:a}=e,l=a.map(e=>({value:e,label:e}));return(0,r.jsxs)(x.Z,{spacing:1,children:[(0,r.jsx)(f.Z,{sx:{fontWeight:500},children:"HCluster:"}),(0,r.jsx)(B.default,{value:t,onChange:n,options:l,style:{width:"240px"},size:"large"})]})},nY=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Margin Top:",config:t,configKey:n,configSubKey:"marginTop",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Bottom:",config:t,configKey:n,configSubKey:"marginBottom",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Left:",config:t,configKey:n,configSubKey:"marginLeft",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Right:",config:t,configKey:n,configSubKey:"marginRight",handleConfigChange:a})]})},nB=(e,t,n,a,l)=>[{key:"data",label:"Data Setting",extra:(0,r.jsx)(tb.Z,{}),children:(0,r.jsx)(nF,{hcluster:n,handleHclusterChange:a,clusterList:l})},{key:"chart",label:"Chart Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(nY,{config:e,configKey:"chart",handleConfigChange:t})}];var nW=e=>{let{hcluster:t,handleHclusterChange:n,clusterList:a,config:l,handleConfigChange:o}=e,[i,s]=(0,F.useState)(["data","chart"]),c=(0,F.useMemo)(()=>nB(l,o,t,n,a),[a,l,o,n,t]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:c,activeKey:i,onChange:e=>{s(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})};let nK=(e,t,n)=>{let r="hg19"===n?ev:ef,{nodePairs:a,prevValue:l,prevEnd:o}=nD(e,t);for(let n=0;n<t.length;n++){let o=e[t[n]],i=t[n].match(/chr([XY\d]+):(\d+)-(\d+)/),s="chr".concat(i[1]),c=parseInt(i[2])+r[s],d=parseInt(i[3])+r[s];l!==o&&(a.push([c,o]),l=o),n===t.length-1&&a.push([d,o])}return a},nO=(e,t,n,r,a)=>{let l="hg19"===a?eC:eu,o=e-n.chart.marginLeft-n.chart.marginRight,i=t-n.chart.marginTop-n.chart.marginBottom,s=45+n.chart.marginTop,c=[n.chart.marginLeft,n.chart.marginLeft+o],d=[n.chart.marginTop+s+(i-s),n.chart.marginTop+s],h=eN.BYU().domain("hg19"===a?eb:em).range([c[0],c[1]]),g=0===r?[-3,3]:[0,10],x=eN.BYU().domain([g[0],g[1]]).range([d[0],d[1]]);return{xRange:c,yRange:d,x:h,y:x,xAxis:(e,t)=>{let n=Object.keys(l);e.call(eN.LLu(t).tickValues(n).tickFormat(e=>l[e])).call(e=>e.selectAll(".tick line").attr("y2",(e,t)=>t%2==0?"6":"15")).call(e=>e.selectAll(".tick text").attr("y",(e,t)=>t%2==0?"9":"18"))},line:(e,t)=>eN.jvg().curve(eN.jsv).x(e=>t(e[0])).y(e=>x(e[1]))(e)}},nD=(e,t)=>{let n=t[0].match(/chr[\w]+:(\d+)-(\d+)/),r=e[t[0]],a=parseInt(n[2]);return{nodePairs:[[parseInt(n[1]),r]],prevValue:r,prevEnd:a}},nU=e=>(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)("div",{style:{fontSize:18,textAlign:"center",color:"#666",fontWeight:800,lineHeight:"1.5"},children:"".concat(e.chromosome,": ").concat(e.xPosition)}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:eP().round(e.value,3)}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),nV=(0,F.forwardRef)((e,t)=>{let{clusterMean:n,config:a,baselineCNA:l,reference:o,isShowLeft:i,handleIsShowLeftChange:s}=e,{width:c,height:d}=G(),h=i?c-320:c-20,g=d-20,x=(0,F.useRef)(null),u=(0,F.useRef)(null),p=(0,F.useRef)(null),m=(0,F.useRef)(null),j=(0,F.useRef)(null),y=(0,F.useRef)(null),v=(0,F.useRef)(null),C=(0,F.useMemo)(()=>nK(n,Object.keys(n),o),[n,o]),{xRange:w,yRange:b,x:S,y:_,xAxis:Z,line:k}=nO(h,g,a,l,o);return(0,F.useEffect)(()=>{eN.Ys(x.current).call(Z,S),v.current=S},[S,Z]),(0,F.useEffect)(()=>{let e=eN.Ys(u.current);e.selectAll(".tick .assist-line").remove(),e.call(eN.y4O(_)).call(e=>e.select(".domain").remove()).call(e=>e.selectAll(".tick line").clone().attr("class","assist-line").attr("x2",w[1]-w[0]).attr("stroke-opacity",e=>e===l?1:.2).attr("stroke-dasharray",e=>e===l?"10, 10":null)),e.selectAll(".yAxis-label").data([1]).join("text").attr("x",0===l?-24:-18).attr("y",b[1]-20).attr("text-anchor","start").attr("fill","black").attr("font-weight","bold").attr("class","yAxis-label").text(0===l?"↑ CN log2 ratio":"↑ CN")},[l,w,_,b]),(0,F.useEffect)(()=>{eN.Ys(p.current).selectAll("path").data([1]).join("path").attr("clip-path","url(#ploidy-stairstep-clip)").attr("stroke","#1f77b4").attr("fill","transparent").attr("d",k(C,S))},[k,C,S]),(0,F.useEffect)(()=>{let e=eN.sPX().scaleExtent([1,32]).extent([[w[0],b[1]],[w[1],b[0]]]).translateExtent([[w[0],-1/0],[w[1],1/0]]).on("zoom",e=>{v.current=e.transform.rescaleX(S),eN.Ys(p.current).selectAll("path").data([1]).attr("d",k(C,v.current)),eN.Ys(x.current).call(Z,v.current)});eN.Ys(m.current).call(e)},[k,C,S,Z,w,b]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{m.current&&tx(m.current,"Ploidy_Stairstep.svg")}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:i,handleIsShowLeftChange:s,title:"Setting Options"})}),(0,r.jsxs)("svg",{width:h,height:g,ref:m,children:[(0,r.jsx)("clipPath",{id:"ploidy-stairstep-clip",children:(0,r.jsx)("rect",{x:w[0],y:b[1],width:w[1]-w[0],height:b[0]-b[1]})}),(0,r.jsx)("text",{fontSize:"24px",transform:"translate(".concat(h/2,", ").concat(a.chart.marginTop,")"),dy:"1rem",fontWeight:500,textAnchor:"middle",children:"Ploidy Stairstep"}),(0,r.jsx)("g",{ref:x,transform:"translate(0,".concat(b[0],")")}),(0,r.jsx)("g",{ref:u,transform:"translate(".concat(w[0],", 0)")}),(0,r.jsx)("g",{ref:p}),(0,r.jsx)("rect",{transform:"translate(".concat(w[0],", ").concat(b[1],")"),width:w[1]-w[0],height:b[0]-b[1],fill:"transparent",onPointerEnter:e=>nG(e,C,v,j,a.chart.marginLeft,y,b,o),onPointerMove:e=>nG(e,C,v,j,a.chart.marginLeft,y,b,o),onMouseLeave:()=>nX(j,y)}),(0,r.jsx)("g",{ref:y})]}),(0,eX.createPortal)((0,r.jsx)(eq,{ref:j}),document.body)]})}),nG=(e,t,n,r,a,l,o,i)=>{let s="hg19"===i?eC:eu,c=eN.YFb(e=>e[0]).right,d=eN.YFb(e=>parseInt(e)).left,h=parseInt(n.current.invert(eN.cx$(e)[0]+a)),g={},x=Object.keys(s),f=d(x,h),u=s[x[f]],p=0===f?h:h-parseInt(x[f-1]);g.chromosome=u,g.xPosition=p;let m=c(t,h)-1;g.value=t[m][1],eN.Ys(l.current).selectAll("line").data([1]).join("line").attr("x1",n.current(h)).attr("x2",n.current(h)).attr("y1",o[0]).attr("y2",o[1]).attr("stroke-dasharray","5, 5").attr("stroke","black").attr("stroke-opacity",.3).style("pointer-events","none"),r.current.showTooltip(e,nU(g))},nX=(e,t)=>{e.current.hideTooltip(),eN.Ys(t.current).selectAll("line").remove()};nV.displayName="CNAPloidyStairstepPanel";let nq=(e,t)=>{let n=eN.ueB(e,eN.rA8),r=eN.ueB(t,eN.rA8),a={};for(let e of r)a[e.id]=String(e.c_hcluster);let l={},o={};for(let e of n){let t=a[e.id];if(t){for(let[n,r]of(l[t]||(l[t]={},o[t]=0),Object.entries(e)))"id"!==n&&(l[t][n]=(l[t][n]||0)+r);o[t]+=1}}let i={};for(let e of Object.keys(l)){let t=o[e];for(let[n,r]of(i[e]={},Object.entries(l[e])))i[e][n]=r/t}let s=Object.keys(i).sort((e,t)=>Number(e)-Number(t));return{clusterMeans:i,clusterList:s}};var nJ=e=>{let{matrix:t,meta:n,baselineCNA:a,reference:l,vizRef:o}=e,[i,s]=(0,F.useState)(1),[c,d]=(0,F.useState)(!0),[h,g]=(0,F.useState)({chart:{marginTop:20,marginBottom:30,marginLeft:30,marginRight:20}}),{clusterMeans:x,clusterList:f}=(0,F.useMemo)(()=>nq(t,n),[t,n]);return(0,r.jsx)(eh.Z,{isShowLeft:c,leftPanelWidth:300,leftPanel:(0,r.jsx)(nW,{hcluster:i,handleHclusterChange:e=>{s(e)},clusterList:f,config:h,handleConfigChange:(e,t,n)=>{g(r=>({...r,[e]:{...r[e],[t]:n}}))}}),rightPanel:(0,r.jsx)(nV,{clusterMean:x[i],config:h,baselineCNA:a,reference:l,isShowLeft:c,handleIsShowLeftChange:()=>{d(!c)},ref:o})})};let n$=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{matrix:l,isMatrixLoading:o,isMatrixError:i}=U(n.name,t),{meta:s,isMetaLoading:h,isMetaError:g}=J(n.name,t),x="Bin Integer"===n.cn_type?2:0;return o||h?(0,r.jsx)(c.Z,{height:"920px"}):i||g?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(nJ,{matrix:l,meta:s,baselineCNA:x,reference:n.reference,vizRef:a})};var nQ=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"CNA Ploidy Stairstep"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(n$,{selectedWorkflow:t,dataset:n,vizRef:a})})]})};let n0=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.ks)(e,t),i._);return{focalInfo:n||[],isFocalInfoLoading:a,isFocalInfoError:r,mutate:s}},n1=[{value:"all",label:"All"},{value:"chr1",label:"Chr1"},{value:"chr2",label:"Chr2"},{value:"chr3",label:"Chr3"},{value:"chr4",label:"Chr4"},{value:"chr5",label:"Chr5"},{value:"chr6",label:"Chr6"},{value:"chr7",label:"Chr7"},{value:"chr8",label:"Chr8"},{value:"chr9",label:"Chr9"},{value:"chr10",label:"Chr10"},{value:"chr11",label:"Chr11"},{value:"chr12",label:"Chr12"},{value:"chr13",label:"Chr13"},{value:"chr14",label:"Chr14"},{value:"chr15",label:"Chr15"},{value:"chr16",label:"Chr16"},{value:"chr17",label:"Chr17"},{value:"chr18",label:"Chr18"},{value:"chr19",label:"Chr19"},{value:"chr20",label:"Chr20"},{value:"chr21",label:"Chr21"},{value:"chr22",label:"Chr22"}],n2=e=>{let{chromosome:t,handleChromosomeChange:n}=e;return(0,r.jsxs)(x.Z,{spacing:1,children:[(0,r.jsx)(f.Z,{sx:{fontWeight:500},children:"Chromosome:"}),(0,r.jsx)(B.default,{value:t,onChange:n,options:n1,style:{width:"240px"},size:"large"})]})},n6=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Margin Horizontal:",config:t,configKey:n,configSubKey:"marginX",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Vertical:",config:t,configKey:n,configSubKey:"marginY",handleConfigChange:a})]})},n3=(e,t,n,a)=>[{key:"data",label:"Data Setting",extra:(0,r.jsx)(tb.Z,{}),children:(0,r.jsx)(n2,{chromosome:n,handleChromosomeChange:a})},{key:"chart",label:"Chart Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(n6,{config:e,configKey:"chart",handleConfigChange:t})}];var n4=e=>{let{chromosome:t,handleChromosomeChange:n,config:a,handleConfigChange:l}=e,[o,i]=(0,F.useState)(["data","chart"]),s=(0,F.useMemo)(()=>n3(a,l,t,n),[t,a,n,l]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:s,activeKey:o,onChange:e=>{i(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})};let n8=(e,t,n,r)=>{let a=n5(e),l=n7(a,n.filter(e=>"Amp"===e.type),r),o=n5(t),i=n7(o,n.filter(e=>"Del"===e.type),r);return{significantAmpRegions:a,spiltAmpRegionsMap:l,significantDelRegions:o,spiltDelRegionsMap:i}},n5=e=>{let t=[];for(let n of e){let e=n9(n.boundaries);t.push({cytoband:n.cytoband,start:e.range[0],end:e.range[1],genes:n.genes,chromosome:e.chromosome})}return eP().orderBy(t.sort((e,t)=>e.start-t.start),[e=>parseInt(e.chromosome.replace("chr",""),10),"start"],["asc","asc"])},n9=e=>{let t=e.match(/chr([XY\d]+):(\d+)-(\d+)/);return{chromosome:"chr".concat(t[1]),range:[parseInt(t[2]),parseInt(t[3])]}},n7=(e,t,n)=>{let r=Object.keys("hg19"===n?ev:ef).filter(e=>!["chrX","chrY"].includes(e)).sort(eA()),a=r.reduce((e,t)=>(e[t]=[],e),{});for(let e of t)a[e.chromosome].push(e);let l={};for(let t of r){let n=re(a[t],e.filter(e=>e.chromosome===t));l[t]={normalRegions:n.nonOverlappingRegions,significantRegions:n.overlappingRegions}}return l},re=(e,t)=>{let n=[],r=[];for(let a of e){let e=[a];for(let r of t){let t=[];for(let a of e)if(a.end<r.start||a.start>r.end)t.push(a);else{let e=Math.max(a.start,r.start),l=Math.min(a.end,r.end);n.push({...a,start:e,end:l}),a.start<e&&t.push({...a,end:e}),a.end>l&&t.push({...a,start:l})}e=t}r.push(...e)}return{overlappingRegions:n,nonOverlappingRegions:r}},rt=(e,t,n)=>{if("all"!==n)return{normalNodes:rn(e[n].normalRegions,n,t,!1),significantNodes:rn(e[n].significantRegions,n,t,!1)};{let n=[],r=[];for(let a of Object.keys(e).sort(eA()))n.push(...rn(e[a].normalRegions,a,t,!0)),r.push(...rn(e[a].significantRegions,a,t,!0));return{normalNodes:n,significantNodes:r}}},rn=(e,t,n,r,a)=>{let l="hg19"===a?ey:ex;if(0===e.length)return[{x:rr(1,t,r,a),y:0},{x:rr(l[t],t,r,a),y:0}];let o=[{x:rr(1,t,r,a),y:0},{x:rr(e[0].start,t,r,a),y:e[0][n]}],i=e[0][n],s=rr(e[0].end,t,r,a);for(let l of e.slice(1)){let e=rr(l.start,t,r,a),c=rr(l.end,t,r,a),d=l[n];s+1===e?i!==d&&o.push({x:e,y:d}):(o.push({x:s,y:0}),o.push({x:e,y:d})),s=c,i=d}return s!==rr(l[t],t,r,a)&&o.push({x:s,y:0}),o.push({x:rr(l[t],t,r,a),y:0}),o},rr=(e,t,n,r)=>{let a=r?ev:ef;return n?e+a[t]:e},ra=(e,t,n)=>Math.ceil(("all"===t?e:e.filter(e=>e.chromosome===t)).reduce((e,t)=>{let r=t[n];return r>e?r:e},-1/0)),rl=(e,t,n)=>{let r=e-2*n.chart.marginX,a=t-2*n.chart.marginY,l=n.title.marginTop+n.title.marginBottom+Math.ceil(1.31*n.title.fontSize),o=a-l-(n.legend.marginTop+n.legend.marginBottom+n.legend.height)-2*n.label.height,i=l+n.label.height,s=(r-(2*n.legend.width+n.legend.itemGap))/2,c=a-n.legend.marginBottom-n.legend.height,d=(o-n.chromosomeAxis.height)/2,h=[d+n.chromosomeAxis.height,o],g=l+n.label.height+o;return{figureHeight:o,figureWidth:r,yOffsetFigure:i,xOffsetFigure:0,xOffsetLegend:s,yOffsetLegend:c,ampYAxisRange:[d,0],delYAxisRange:h,xAxisRange:[0,r],yOffsetAmpLabel:l,yOffsetDelLabel:g}},ro=(e,t,n,r,a,l)=>{let o,i;let s="hg19"===l?ey:ex;o=eN.BYU().domain([0,r]).range(e),i=eN.BYU().domain([0,r]).range(t);let c="all"===a?"hg19"===l?eS:ej:[0,s[a]];return{ampYAxis:o,delYAxis:i,xAxis:eN.BYU().domain(c).range(n),area:(e,t,n)=>eN.SOn().curve(eN.jsv).x(e=>t(e.x)).y0(n(0)).y1(e=>n(e.y))(e),labelLine:(e,t)=>eN.jvg().curve(eN.c_6).x(e=>t(e.x)).y(e=>e.y)(e),labelLineNodesCreator:(e,t,n,r,a)=>{let l=4.4*r;return a?[{x:t,y:n},{x:t,y:(n+l)/2},{x:e,y:l}]:[{x:t,y:0},{x:t,y:(n-l)/2},{x:e,y:n-l}]}}},ri=(e,t)=>{let n="hg19"===t?ey:ex;return"all"===e?"hg19"===t?ew:ep:{[e]:[1,n[e]]}},rs=(e,t,n)=>{let r="hg19"===n?ev:ef;return"all"===t?e.map(e=>({...e,start:e.start+r[e.chromosome],end:e.end+r[e.chromosome],anchorPosition:(e.start+e.end)/2+r[e.chromosome],labelPosition:(e.start+e.end)/2+r[e.chromosome]})):e.filter(e=>e.chromosome===t).map(e=>({...e,anchorPosition:(e.start+e.end)/2,labelPosition:(e.start+e.end)/2}))},rc=e=>(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)("div",{style:{fontSize:18,textAlign:"center",color:"#666",fontWeight:800,lineHeight:"1.5"},children:"".concat(e.chromosome,": ").concat(e.xPosition)}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:"Type"}),(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:e.type}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsxs)("div",{style:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)("div",{style:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)("span",{style:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:e.valueType}),(0,r.jsx)("span",{style:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:e.value}),(0,r.jsx)("div",{style:{clear:"both"}})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})]}),(0,r.jsx)("div",{style:{clear:"both"}})]}),rd=e=>e.filter(e=>{let t=e.Chromosome.trim();return"23"!==t&&"24"!==t}).map(e=>({type:e.Type,chromosome:"chr"+e.Chromosome.trim(),start:+e.Start,end:+e.End,"q-value":+e["-log10(q-value)"],"G-score":+e["G-score"],"average amplitude":+e["average amplitude"],frequency:+e.frequency})),rh=(0,F.forwardRef)((e,t)=>{let{chromosome:n,focalInfo:a,config:l,reference:o,isShowLeft:i,handleIsShowLeftChange:s}=e,{width:c,height:d}=G(),h=i?c-320:c-20,g=d-20,x=(0,F.useRef)(null),u=(0,F.useRef)(null),p=(0,F.useRef)(null),m=(0,F.useRef)(null),j=(0,F.useRef)(null),y=(0,F.useRef)(null),v=(0,F.useRef)(null),C=(0,F.useRef)(null),w=(0,F.useRef)(null),b=(0,F.useRef)(null);(0,F.useRef)(null),(0,F.useRef)(null),(0,F.useRef)(null);let S=rd(a.scores),{significantAmpRegions:_,spiltAmpRegionsMap:Z,significantDelRegions:k,spiltDelRegionsMap:A}=(0,F.useMemo)(()=>n8(a.amp,a.del,S,o),[a.amp,a.del,o,S]),N=(0,F.useMemo)(()=>rt(Z,"G-score",n),[n,Z]),L=(0,F.useMemo)(()=>rt(A,"G-score",n),[n,A]),T=(0,F.useMemo)(()=>ra(S,n,"G-score"),[n,S]),{figureHeight:P,figureWidth:M,yOffsetFigure:R,xOffsetFigure:z,xOffsetLegend:I,yOffsetLegend:E,ampYAxisRange:H,delYAxisRange:Y,xAxisRange:B,yOffsetAmpLabel:W,yOffsetDelLabel:K}=(0,F.useMemo)(()=>rl(h,g,l),[l,g,h]),{ampYAxis:O,delYAxis:D,xAxis:U,area:V,labelLine:X,labelLineNodesCreator:q}=(0,F.useMemo)(()=>ro(H,Y,B,T,n,o),[H,n,Y,o,B,T]),J=(0,F.useMemo)(()=>ri(n,o),[n,o]);(0,F.useMemo)(()=>rs(_,n,o),[n,o,_]),(0,F.useMemo)(()=>rs(k,n,o),[n,o,k]);let $=(0,F.useRef)(U);return $.current=U,(0,F.useEffect)(()=>{eN.Ys(m.current).call(eN.y4O(O))},[O]),(0,F.useEffect)(()=>{eN.Ys(j.current).call(eN.y4O(D))},[D]),(0,F.useEffect)(()=>{let e=eN.Ys(y.current);e.selectAll("rect").data(Object.keys(J).filter(e=>!["chrX","chrY"].includes(e)).sort(eA())).join("rect").attr("x",e=>U(J[e][0])).attr("width",e=>U(J[e][1])-U(J[e][0])).attr("height",l.chromosomeAxis.height).attr("fill",(e,t)=>t%2==0?"black":"white").attr("stroke","black"),e.selectAll("text").data(Object.keys(J).filter(e=>!["chrX","chrY"].includes(e)).sort(eA())).join("text").attr("x",e=>(U(J[e][0])+U(J[e][1]))/2).attr("y",l.chromosomeAxis.height/2).attr("dy",".31em").attr("fill",(e,t)=>t%2==0?"white":"black").attr("text-anchor","middle").attr("font-size","14px").text(e=>e.replace(/^chr/,""))},[J,l.chromosomeAxis.height,U]),(0,F.useEffect)(()=>{eN.Ys(v.current).selectAll("path").data(["amp"]).join("path").attr("fill","gray").attr("d",V(N.normalNodes,U,O)).attr("clip-path","url(#recurrent-regions-clip)")},[N.normalNodes,O,V,U]),(0,F.useEffect)(()=>{eN.Ys(C.current).selectAll("path").data(["ampRecurrent"]).join("path").attr("fill","red").attr("d",V(N.significantNodes,U,O)).attr("clip-path","url(#recurrent-regions-clip)")},[N.significantNodes,O,V,U]),(0,F.useEffect)(()=>{eN.Ys(w.current).selectAll("path").data(["del"]).join("path").attr("fill","gray").attr("d",V(L.normalNodes,U,D)).attr("clip-path","url(#recurrent-regions-clip)")},[V,L.normalNodes,D,U]),(0,F.useEffect)(()=>{eN.Ys(b.current).selectAll("path").data(["delRecurrent"]).join("path").attr("fill","blue").attr("d",V(L.significantNodes,U,D)).attr("clip-path","url(#recurrent-regions-clip)")},[D,V,U,L.significantNodes]),(0,F.useEffect)(()=>{let e=eN.sPX().scaleExtent([1,32]).extent([[z,R],[z+M,R+P]]).translateExtent([[z,-1/0],[z+M,1/0]]).on("zoom",e=>{$.current=e.transform.rescaleX(U),eN.Ys(v.current).select("path").attr("d",V(N.normalNodes,$.current,O)),eN.Ys(C.current).select("path").attr("d",V(N.significantNodes,$.current,O)),eN.Ys(w.current).select("path").attr("d",V(L.normalNodes,$.current,D)),eN.Ys(b.current).select("path").attr("d",V(L.significantNodes,$.current,D)),eN.Ys(y.current).selectAll("rect").attr("x",e=>$.current(J[e][0])).attr("width",e=>$.current(J[e][1])-$.current(J[e][0])),eN.Ys(y.current).selectAll("text").attr("x",e=>($.current(J[e][0])+$.current(J[e][1]))/2)});eN.Ys(x.current).call(e)},[N.normalNodes,N.significantNodes,O,V,J,L.normalNodes,L.significantNodes,D,P,M,U,z,R]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{x.current&&tx(x.current,"Focal_CNA_&_Gene.svg")}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:i,handleIsShowLeftChange:s,title:"Setting Options"})}),(0,r.jsxs)("svg",{width:h,height:g,ref:x,children:[(0,r.jsxs)("defs",{children:[(0,r.jsx)("clipPath",{id:"recurrent-regions-clip",children:(0,r.jsx)("rect",{x:z,y:R,width:M,height:P})}),(0,r.jsx)("clipPath",{id:"chromosome-axis-clip",children:(0,r.jsx)("rect",{x:0,y:0,height:g,width:M})})]}),(0,r.jsxs)("g",{transform:"translate(".concat(l.chart.marginX,", ").concat(l.chart.marginY,")"),children:[(0,r.jsx)("g",{className:"title",children:(0,r.jsx)("text",{fontSize:l.title.fontSize,transform:"translate(".concat(M/2,", ").concat(l.title.marginTop,")"),dy:"1em",fontWeight:500,textAnchor:"middle",children:"Focal CNA & Gene"})}),(0,r.jsxs)("g",{className:"figure",transform:"translate(".concat(z,", ").concat(R,")"),children:[(0,r.jsx)("g",{ref:m}),(0,r.jsx)("g",{ref:j}),(0,r.jsx)("g",{ref:y,transform:"translate(0, ".concat(H[0],")"),clipPath:"url(#chromosome-axis-clip)"}),(0,r.jsx)("g",{ref:v}),(0,r.jsx)("g",{ref:C}),(0,r.jsx)("g",{ref:w}),(0,r.jsx)("g",{ref:b}),(0,r.jsx)("rect",{width:M,height:Math.abs(H[0]-H[1]),fill:"transparent",onPointerMove:e=>rg(e,$,N,_,n,"G-score",u,"Amp",p,H,o),onPointerLeave:()=>rx(u,p)}),(0,r.jsx)("rect",{y:Math.abs(H[0]-H[1])+l.chromosomeAxis.height,width:M,height:Math.abs(Y[0]-Y[1]),fill:"transparent",onPointerMove:e=>rg(e,$,L,k,n,"G-score",u,"Del",p,Y,o),onPointerLeave:()=>rx(u,p)}),(0,r.jsx)("g",{ref:p})]})]})]}),(0,eX.createPortal)((0,r.jsx)(eq,{ref:u}),document.body)]})}),rg=(e,t,n,r,a,l,o,i,s,c,d)=>{let h,g,x;let f="hg19"===d?eC:eu,u=eN.YFb(e=>e.x).right,p=eN.YFb(e=>parseInt(e)).left,m=parseInt(t.current.invert(eN.cx$(e)[0]));if("all"===a){let e=Object.keys(f),t=p(e,m);h=f[e[t]],g=0===t?m:m-parseInt(e[t-1])}else h=a,g=m;if(void 0===r.find(e=>e.chromosome===h&&e.start<=g&&e.end>=g)){let e=u(n.normalNodes,m)-1;x=n.normalNodes[e].y}else{let e=u(n.significantNodes,m)-1;x=n.significantNodes[e].y}eN.Ys(s.current).selectAll("line").data([1]).join("line").attr("x1",t.current(m)).attr("x2",t.current(m)).attr("y1",c[0]).attr("y2",c[1]).attr("stroke-dasharray","5, 5").attr("stroke","black").attr("stroke-opacity",.3).style("pointer-events","none"),o.current.showTooltip(e,rc({chromosome:h,xPosition:g,valueType:l,value:x,type:i}))},rx=(e,t)=>{e.current.hideTooltip(),eN.Ys(t.current).selectAll("line").remove()};rh.displayName="FocalCNAPlotPanel";var rf=e=>{let{focalInfo:t,reference:n,vizRef:a}=e,[l,o]=(0,F.useState)("all"),[i,s]=(0,F.useState)(!0),[c,d]=(0,F.useState)({chart:{marginX:30,marginY:20},areaPlot:{width:500},title:{marginTop:5,marginBottom:5,fontSize:24},legend:{width:90,height:20,itemGap:5,marginTop:10,marginBottom:0,symbolWidth:30,fontSize:14},label:{fontSize:10,height:70},chromosomeAxis:{height:20}});return(0,r.jsx)(eh.Z,{isShowLeft:i,leftPanelWidth:300,leftPanel:(0,r.jsx)(n4,{chromosome:l,handleChromosomeChange:e=>{o(e)},config:c,handleConfigChange:(e,t,n)=>{d(r=>({...r,[e]:{...r[e],[t]:n}}))}}),rightPanel:(0,r.jsx)(rh,{chromosome:l,focalInfo:t,config:c,reference:n,isShowLeft:i,handleIsShowLeftChange:()=>{s(!i)},ref:a})})};let ru=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{focalInfo:l,isFocalInfoLoading:o,isFocalInfoError:i}=n0(n.name,t);return o?(0,r.jsx)(c.Z,{height:"920px"}):i?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(rf,{focalInfo:l,reference:n.reference,vizRef:a})};var rp=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"Focal CNA & Gene"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(ru,{dataset:n,selectedWorkflow:t,vizRef:a})})]})};let rm=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsx)(x.Z,{spacing:2,children:(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Margin Horizontal:",config:t,configKey:n,configSubKey:"marginX",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Vertical:",config:t,configKey:n,configSubKey:"marginY",handleConfigChange:a})]})})},rj=(e,t)=>[{key:"chart",label:"Chart Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(rm,{config:e,configKey:"chart",handleConfigChange:t})}];var ry=e=>{let{config:t,handleConfigChange:n}=e,[a,l]=(0,F.useState)(["chart"]),o=(0,F.useMemo)(()=>rj(t,n),[t,n]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:o,activeKey:a,onChange:e=>{l(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})};let rv=(e,t,n)=>{e.radius=(t+=e.data.length)*n,e.children&&e.children.forEach(e=>rv(e,t,n))},rC=e=>e.data.length+(e.children?eN.Fp7(e.children,rC):0),rw=(e,t)=>{let n=eN.bT9(eM(e),e=>e.children).sum(e=>e.children?0:1).sort((e,t)=>e.value-t.value||eN.j2p(e.data.length,t.data.length));return eN.ki8().size([360,t]).separation((e,t)=>1)(n),rv(n,n.data.length=0,t/rC(n)),n};function rb(e){return function(e,t,n,r){let a=Math.cos(e=(e-90)/180*Math.PI),l=Math.sin(e),o=Math.cos(n=(n-90)/180*Math.PI),i=Math.sin(n);return"M"+t*a+","+t*l+(n===e?"":"A"+t+","+t+" 0 0 "+(n>e?1:0)+" "+t*o+","+t*i)+"L"+r*o+","+r*i}(e.source.x,e.source.y,e.target.x,e.target.y)}function rS(e){return function(t,n){eN.Ys(this).classed("label--active",e);do eN.Ys(n.linkNode).classed("link--active",e).raise();while(n=n.parent)}}let r_=e=>{let{children:t}=e;return(0,r.jsxs)(f.Z,{sx:{margin:"0px 0 0",lineHeight:1},children:[(0,r.jsx)(f.Z,{sx:{margin:"0px 0 0",lineHeight:1},children:t}),(0,r.jsx)(f.Z,{sx:{clear:"both"}})]})},rZ=e=>{let{headerName:t}=e;return(0,r.jsx)(f.Z,{sx:{fontSize:18,textAlign:"center",color:"#666",fontWeight:800,lineHeight:"1.5"},children:t})},rk=e=>{let{groupName:t,groupValue:n}=e;return(0,r.jsxs)(f.Z,{sx:{margin:"10px 0 0",lineHeight:1},children:[(0,r.jsxs)(f.Z,{sx:{margin:"0 0 0",lineHeight:1},children:[(0,r.jsx)(f.Z,{component:"span",sx:{fontSize:14,color:"#666",fontWeight:400,marginLeft:2},children:t}),(0,r.jsx)(f.Z,{component:"span",sx:{float:"right",marginLeft:20,fontSize:14,color:"#666",fontWeight:900},children:n}),(0,r.jsx)(f.Z,{sx:{clear:"both"}})]}),(0,r.jsx)(f.Z,{sx:{clear:"both"}})]})},rA=e=>(0,r.jsxs)(r_,{children:[e.data.name?(0,r.jsx)(rZ,{headerName:e.data.name}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)(rk,{groupName:"Distance To Root",groupValue:e.data.length})]}),rN=(0,F.forwardRef)((e,t)=>{let{newick:n,config:a,isShowLeft:l,handleIsShowLeftChange:o}=e,{width:i,height:s}=G(),c=l?i-320:i-20,d=s-20,h=c>d?d:c,g=h/2,u=g-220,p=(0,F.useRef)(null),m=(0,F.useRef)(null),j=(0,F.useRef)(null),y=(0,F.useRef)(null),v=(0,F.useRef)(null),C=(0,F.useMemo)(()=>rw(n,u),[u,n]),w=(0,F.useMemo)(()=>C.links(),[C]),b=(0,F.useMemo)(()=>C.descendants(),[C]),S=(0,F.useMemo)(()=>C.leaves(),[C]),_=(e,t)=>{v.current.showTooltip(e,rA(t))},Z=()=>{v.current.hideTooltip()};return(0,F.useEffect)(()=>{eN.Ys(m.current).selectAll("path").data(w).join("path").each(function(e){e.target.linkNode=this}).attr("d",rb)},[w]),(0,F.useEffect)(()=>{eN.Ys(j.current).selectAll("circle").data(b).join("circle").attr("fill",e=>e.children?"#999":"#8fc8f5").attr("r",e=>e.children?3:4).attr("transform",e=>{var t,n;return t=e.x,n=e.y,"rotate(".concat(t-90,") translate(").concat(n,",0)")}).on("pointermove",(e,t)=>_(e,t)).on("pointerout",Z)},[b]),(0,F.useEffect)(()=>{eN.Ys(y.current).selectAll("text").data(S).join("text").attr("dy",".31em").attr("transform",e=>"rotate(".concat(e.x-90,") translate(").concat(u+12,",0)").concat(e.x<180?"":" rotate(180)")).attr("text-anchor",e=>e.x<180?"start":"end").text(e=>e.data.name.replace(/_/g," ")).on("mouseover",rS(!0)).on("mouseout",rS(!1)).on("pointermove",(e,t)=>_(e,t)).on("pointerout",Z)},[u,S]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{p.current&&tx(p.current,"PhylogeneticTree.svg")}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:l,handleIsShowLeftChange:o,title:"Setting Options"})}),(0,r.jsx)(x.Z,{alignItems:"center",justifyContent:"center",children:(0,r.jsxs)("svg",{ref:p,width:c,height:d,viewBox:[-g,-g,h,h],fontFamily:"sans-serif",fontSize:10,children:[(0,r.jsx)("style",{children:"\n                            .link--active {\n                              stroke: #000 !important;\n                              stroke-width: 1.5px;\n                            }\n                        \n                            .link-extension--active {\n                              stroke-opacity: .6;\n                            }\n                        \n                            .label--active {\n                              font-weight: bold;\n                            }\n                        "}),(0,r.jsx)("g",{className:"Links",ref:m,fill:"none",stroke:"#aaa"}),(0,r.jsx)("g",{className:"Nodes",ref:j}),(0,r.jsx)("g",{className:"Texts",ref:y})]})}),(0,eX.createPortal)((0,r.jsx)(eq,{ref:v}),document.body)]})});rN.displayName="PhylogeneticTreePanel";var rL=e=>{let{meta:t,newick:n,vizRef:a}=e,[l,o]=(0,F.useState)(!0),[i,s]=(0,F.useState)({chart:{marginX:30,marginY:20}});return(0,r.jsx)(eh.Z,{isShowLeft:l,leftPanelWidth:300,leftPanel:(0,r.jsx)(ry,{config:i,handleConfigChange:(e,t,n)=>{s(r=>({...r,[e]:{...r[e],[t]:n}}))}}),rightPanel:(0,r.jsx)(rN,{newick:n,config:i,isShowLeft:l,handleIsShowLeftChange:()=>{o(!l)},ref:a})})};let rT=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{meta:l,isMetaLoading:o,isMetaError:i}=J(n.name,t),{newick:s,isNewickLoading:h,isNewickError:g}=tC(n.name,t);return o||h?(0,r.jsx)(c.Z,{height:"920px"}):i||g?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(rL,{meta:l,newick:s,vizRef:a})};var rP=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"CNA Phylogenetic Tree"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(rT,{selectedWorkflow:t,dataset:n,vizRef:a})})]})};let rM=(e,t)=>{let{data:n,error:r,isLoading:a,mutate:s}=(0,l.ZP)((0,o.gy)(e,t),i._);return{distributions:n,isDistributionsLoading:a,isDistributionsError:r,mutate:s}},rR=e=>{let{config:t,configKey:n,handleConfigChange:a}=e;return(0,r.jsxs)(x.Z,{spacing:2,children:[(0,r.jsx)(en,{title:"Margin Top:",config:t,configKey:n,configSubKey:"marginTop",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Bottom:",config:t,configKey:n,configSubKey:"marginBottom",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Left:",config:t,configKey:n,configSubKey:"marginLeft",handleConfigChange:a}),(0,r.jsx)(en,{title:"Margin Right:",config:t,configKey:n,configSubKey:"marginRight",handleConfigChange:a})]})},rz=(e,t)=>[{key:"chart",label:"Chart Setting",extra:(0,r.jsx)(er.Z,{}),children:(0,r.jsx)(rR,{config:e,configKey:"chart",handleConfigChange:t})}];var rI=e=>{let{config:t,handleConfigChange:n}=e,[a,l]=(0,F.useState)(["chart"]),o=(0,F.useMemo)(()=>rz(t,n),[t,n]);return(0,r.jsxs)(f.Z,{sx:{paddingLeft:"12px",paddingTop:"12px",height:"920px",maxHeight:"920px"},children:[(0,r.jsx)(Q.ZP,{theme:{components:{Collapse:{headerBg:"#FFFFFF",fontSize:"16px",headerPadding:"16px 16px"}}},children:(0,r.jsx)(ee.Z,{items:o,activeKey:a,onChange:e=>{l(e)},size:"middle"})}),(0,r.jsx)(f.Z,{sx:{paddingTop:"12px"}})]})};let rE=(e,t,n,r)=>{let a=e-n.chart.marginLeft-n.chart.marginRight,l=t-n.chart.marginTop-n.chart.marginBottom,o=45+n.chart.marginTop,i=[n.chart.marginLeft,n.chart.marginLeft+a],s=[n.chart.marginTop+o+(l-o),n.chart.marginTop+o],c=r.map(e=>e[0]),d=r.map(e=>e[1]),h=eN.BYU().domain([Math.min(...c),Math.max(...c)]).range([i[0],i[1]]),g=eN.BYU().domain([0,Math.ceil(Math.log10(Math.max(...d)))]).range([s[0],s[1]]);return{xRange:i,yRange:s,x:h,y:g,area:e=>eN.SOn().x(e=>h(e[0])).y0(g(0)).y1(e=>g(0===e[1]?0:Math.log10(e[1])))(e)}},rH=(0,F.forwardRef)((e,t)=>{let{distributions:n,config:a,isShowLeft:l,handleIsShowLeftChange:o}=e,{width:i,height:s}=G(),c=l?i-320:i-20,d=s-20,h=(0,F.useRef)(null),g=(0,F.useRef)(null),x=(0,F.useRef)(null),u=(0,F.useRef)(null),{xRange:p,yRange:m,x:j,y,area:v}=rE(c,d,a,n);return(0,F.useEffect)(()=>{eN.Ys(g.current).call(eN.LLu(j).ticks((p[1]-p[0])/80))},[j,p]),(0,F.useEffect)(()=>{let e=eN.Ys(x.current);e.selectAll(".tick .assist-line").remove(),e.call(eN.y4O(y)).call(e=>e.select(".domain").remove()).call(e=>e.selectAll(".tick line").clone().attr("class","assist-line").attr("x2",p[1]-p[0]).attr("stroke-opacity",.2).attr("stroke-dasharray","10, 10")),e.selectAll(".yAxis-label").data([1]).join("text").attr("x",-24).attr("y",m[1]-20).attr("text-anchor","start").attr("fill","black").attr("font-weight","bold").attr("class","yAxis-label").text("log10(Count)")},[p,y,m]),(0,F.useEffect)(()=>{eN.Ys(u.current).selectAll("path").data([1]).join("path").attr("stroke","#1f77b4").attr("fill","#1f77b4").attr("d",v(n))},[v,n]),(0,F.useImperativeHandle)(t,()=>({downloadSvg:()=>{h.current&&tx(h.current,"CNA_Ploidy_Distribution.svg")}})),(0,r.jsxs)(f.Z,{sx:{position:"relative",height:"920px"},children:[(0,r.jsx)(f.Z,{sx:{position:"absolute",top:"14px",left:"4px"},children:(0,r.jsx)(eg.Z,{isShowLeft:l,handleIsShowLeftChange:o,title:"Setting Options"})}),(0,r.jsxs)("svg",{width:c,height:d,ref:h,children:[(0,r.jsx)("text",{fontSize:"24px",transform:"translate(".concat(c/2,", ").concat(a.chart.marginTop,")"),dy:"1rem",fontWeight:500,textAnchor:"middle",children:"CNA Ploidy Distribution"}),(0,r.jsx)("g",{ref:g,transform:"translate(0,".concat(m[0],")")}),(0,r.jsx)("g",{ref:x,transform:"translate(".concat(p[0],", 0)")}),(0,r.jsx)("g",{ref:u})]})]})});rH.displayName="PloidyDistributionPanel";var rF=e=>{let{distributions:t,vizRef:n}=e,[a,l]=(0,F.useState)(!0),[o,i]=(0,F.useState)({chart:{marginTop:50,marginBottom:50,marginLeft:30,marginRight:20},title:{fontSize:24,fontWeight:500}});return(0,r.jsx)(eh.Z,{isShowLeft:a,leftPanelWidth:300,leftPanel:(0,r.jsx)(rI,{config:o,handleConfigChange:(e,t,n)=>{i(r=>({...r,[e]:{...r[e],[t]:n}}))}}),rightPanel:(0,r.jsx)(rH,{distributions:t,config:o,isShowLeft:a,handleIsShowLeftChange:()=>{l(!a)},ref:n})})};let rY=e=>{let{selectedWorkflow:t,dataset:n,vizRef:a}=e,{distributions:l,isDistributionsLoading:o,isDistributionsError:i}=rM(n.name,t);return o?(0,r.jsx)(c.Z,{height:"920px"}):i?(0,r.jsx)(d.Z,{height:"920px"}):(0,r.jsx)(rF,{distributions:l,vizRef:a})};var rB=e=>{let{selectedWorkflow:t,dataset:n}=e,a=(0,F.useRef)(null);return(0,r.jsxs)(x.Z,{spacing:4,children:[(0,r.jsxs)(x.Z,{direction:"row",spacing:6,alignItems:"center",sx:{borderBottom:"2px solid #e0e0e0",paddingBottom:"12px"},children:[(0,r.jsx)(f.Z,{component:"h6",sx:{fontSize:"36px"},children:"CNA Ploidy Distribution"}),(0,r.jsx)(x.Z,{direction:"row",spacing:2,children:(0,r.jsx)(tp.ZP,{type:"primary",onClick:()=>{var e;return null===(e=a.current)||void 0===e?void 0:e.downloadSvg()},size:"large",icon:(0,r.jsx)(tm.Z,{}),children:"Download SVG Chart"})})]}),(0,r.jsx)(q,{children:(0,r.jsx)(rY,{selectedWorkflow:t,dataset:n,vizRef:a})})]})},rW=e=>{let{dataset:t}=e,[n,a]=(0,F.useState)(null);return(0,F.useEffect)(()=>{t.workflow?a(t.workflow.split(",")[0]):a("NA")},[t.workflow]),(0,r.jsxs)(x.Z,{spacing:4,sx:{pt:"12px",px:"32px"},children:[(0,r.jsx)(A,{dataset:t}),"bulkDNA"===t.modality?(0,r.jsx)(P,{dataset:t}):"scDNA"===t.modality?(0,r.jsx)(R,{dataset:t}):"scRNA"===t.modality?(0,r.jsx)(I,{dataset:t}):"ST"===t.modality?(0,r.jsx)(H,{dataset:t}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)(D,{workflow:t.workflow,selectedWorkflow:n,handleSelectedWorkflowChange:e=>{a(e)}}),n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ty,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(np,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(ny,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(rP,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(nH,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(nQ,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(rB,{dataset:t,selectedWorkflow:n}),(0,r.jsx)(rp,{dataset:t,selectedWorkflow:n})]}):(0,r.jsx)(r.Fragment,{}),(0,r.jsx)(f.Z,{})]})},rK=e=>{let{}=e,t=(0,a.useRouter)(),{datasetName:n}=t.query,{dataset:l,isLoading:o,isError:i}=s(n);return!t.isReady||o?(0,r.jsx)(c.Z,{containerSx:{height:"80vh",marginTop:"40px"}}):i?(0,r.jsx)(d.Z,{containerSx:{height:"80vh",marginTop:"40px"}}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(g(),{children:[(0,r.jsxs)("title",{children:[l.name," | CNAScope"]}),(0,r.jsx)("meta",{name:"description",content:"Details of dataset ".concat(l.name)})]}),(0,r.jsx)(rW,{dataset:l})]})}}},function(e){e.O(0,[662,920,70,507,944,841,721,236,276,43,4,664,895,888,774,179],function(){return e(e.s=7609)}),_N_E=e.O()}]);